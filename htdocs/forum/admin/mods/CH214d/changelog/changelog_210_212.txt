##############################################################
##
## Upgrade path from 2.1.0 to 2.1.2
##
##
##	- language changelog can be found line 4024
##		nb.: lang_CH_install.php is a new language file (used by the data migration tool at install time)
##
##	- subSilver changelog can be found line 4368 :
##		nb.: if you don't use subSilver but ptifo, you can skip this part
##
## Changelog :
##	2.1.2
##      - rebuild the installation onto phpBB 2.0.17,
##	- enhance compliancy with php 5.0.5,
##	- add a security fix regarding cookies,
##	- fix the posting when no post icons are available,
##	- ensure you can't post into a link or a category forum whatever auths are,
##	- remove topic calendar version from config table if topic calendar is no more present,
##	- remove "empty message" in posting when canceling the form,
##
##	2.1.1RC6
##	- clean // in front of deleted/replaced blocks,
##	- ptifo template added, subSilver template reviewed to enhance W3C compliancy,
##	- add the dst management at user level,
##	- rewrite the installer,
##	- optimize the template parser,
##	- optimize the topics list reading,
##
##	2.1.1RC5
##	- add in privmsg.php the send to the template the detailed links and pics,
##	- remove from posting_body.tpl the moderators lines (as they aren't filled),
##	- prevent relog in ACP when .htaccess is present,
##
##	2.1.1RC4
##	- enhance the tpls coding (remove subSilver hardcoded things tied in the phps),
##	- add the pagination to topic review area,
##	- add a templates/your_template/your_template.ini read to handle commands specific to a template (ie tpl var assignation),
##
##	2.1.1RC3
##	- enhance compliancy with postgresql version prior to v8 for the installer,
##	- fix a bug when using eXtreme Style,
##	- adapt includes/sessions.php modifications since phpBB 2.0.14,
##
##	2.1.1RC2
##	- fix memberlist pagination,
##	- fix a message coming when creating a new topic with Topic Calendar CH edition installed,
##	- fix in search the missing pagination,
##	- change the way the posts icons are displayed (move html for pic from php to tpl),
##	- remove default posts icon on replies,
##	- clean html when topics title attribute are used as bubble-info with pic,
##
##	2.1.1RC1
##	- add version check in ACP/Index,
##	- add a warning when a new reply has been made while you were editing/create a new reply to the topic,
##	- add the ability to create topic title tags, with images or not,
##	- topics moved gets their own topic folder icon, copied from the moderation button on viewtopic (templates/subSilver/images/topic_move.gif),
##	- topic icons permissions are now based on a forum auth rather than a user level, allowing so to create specific auth for some (ie for groups),
##	- re-add the unmark topic at bottom of viewtopic (was already at top) when keep unread functionality is activated,
##	- fix the date type fields issue appearing with topic calendar CH edition,
##	- calendar icon changed, calendar folder icons added
##	- guests if authorized will be able to edit only the messages posted with the same ip than the one they are using, no more all guests posts,
##	- "0 posts/topics + no topics" are no more displayed on index when the user can view but not read the forum,
##	- add the <!-- INCLUDE xxx.tpl --> feature to the templates parser,
##	- change the way the data caches files are encoded,
##	- all parent forum auths of the forum manager groups are now reported to the new forum when creating one
##
##############################################################
#
#
#-----[ DIY INSTRUCTIONS ]------------------------------------
#
DELETE includes/_cp_patches/patch_ucp_prefs.php
DELETE includes/_cp_patches/patch_ucp_prefs_ch.php
DELETE includes/functions_php4emul.php
DELETE caches/*.php
#
#-----[ COPY ]------------------------------------------------
#
COPY root/index.php TO index.php
COPY root/usercp.php TO usercp.php
#
#-----[ COPY ]------------------------------------------------
#
COPY root/admin/admin_auth.php TO admin/admin_auth.php
COPY root/admin/admin_auths_def.php TO admin/admin_auths_def.php
COPY root/admin/admin_caches.php TO admin/admin_caches.php
COPY root/admin/admin_forums.php TO admin/admin_forums.php
COPY root/admin/admin_icons.php TO admin/admin_icons.php
COPY root/admin/admin_settings.php TO admin/admin_settings.php
COPY root/admin/admin_topics_attr.php TO admin/admin_topics_attr.php
#
#-----[ COPY ]------------------------------------------------
#
COPY root/images/icons/icon22.gif TO images/icons/icon22.gif
#
#-----[ COPY ]------------------------------------------------
#
COPY root/includes/_cp_patches/patch_ucp_preferences.php TO includes/_cp_patches/patch_ucp_preferences.php
#
#-----[ COPY ]------------------------------------------------
#
COPY root/includes/acp/acp_generic.php TO includes/acp/acp_generic.php
COPY root/includes/ucp/ucp_generic.php TO includes/ucp/ucp_generic.php
#
#-----[ COPY ]------------------------------------------------
#
COPY root/includes/class_config.php TO includes/class_config.php
COPY root/includes/class_cp.php TO includes/class_cp.php
COPY root/includes/class_db.php TO includes/class_db.php
COPY root/includes/class_form.php TO includes/class_form.php
COPY root/includes/class_forums.php TO includes/class_forums.php
COPY root/includes/class_groups.php TO includes/class_groups.php
COPY root/includes/class_groups_select.php TO includes/class_groups_select.php
COPY root/includes/class_install.php TO includes/class_install.php
COPY root/includes/class_run_stats.php TO includes/class_run_stats.php
COPY root/includes/class_stats.php TO includes/class_stats.php
COPY root/includes/class_template.php TO includes/class_template.php
COPY root/includes/class_topics.php TO includes/class_topics.php
COPY root/includes/class_user.php TO includes/class_user.php
COPY root/includes/js_dom_menus.js TO includes/js_dom_menus.js
COPY root/includes/js_dom_timezone.js TO includes/js_dom_timezone.js
COPY root/includes/js_dom_toggle.js TO includes/js_dom_toggle.js
#
#-----[ COPY ]------------------------------------------------
#
COPY root/install_cat/*.* TO install_cat/*.*
#
#-----[ COPY ]------------------------------------------------
#
# You will find other language modifications from line 4024
#
COPY root/language/lang_english/lang_CH_install.php TO language/lang_english/lang_CH_install.php
#
#-----[ COPY ]------------------------------------------------
#
# ptifo template is required.
# If you don't want to use it, you will be further able to delete it first in ACP then from ftp,
# but you need it for the install.
#
# If you used a previous version (alpha) of ptifo, delete first templates/ptifo/ directory prior copying the new one.
# Remind also to delete in caches/ directory any cached tpl if you use a template cache system (ie eXtreme style or Extended template goody).
#
COPY root/templates/ptifo/*.* TO templates/ptifo/*.*
#
#-----[ OPEN ]------------------------------------------------
#
common.php
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
// include($phpbb_root_path . 'includes/template.'.$phpEx);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
include($phpbb_root_path . 'includes/template.'.$phpEx);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
// $sql = "SELECT *
//	FROM " . CONFIG_TABLE;
// if( !($result = $db->sql_query($sql)) )
// {
//	message_die(CRITICAL_ERROR, "Could not query config information", "", __LINE__, __FILE__, $sql);
// }
//
// while ( $row = $db->sql_fetchrow($result) )
// {
//	$board_config[$row['config_name']] = $row['config_value'];
// }
//-- add
// include basic classes def
include($phpbb_root_path . 'includes/class_config.' . $phpEx);
include($phpbb_root_path . 'includes/class_groups.' . $phpEx);
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
$sql = "SELECT *
	FROM " . CONFIG_TABLE;
if( !($result = $db->sql_query($sql)) )
{
	message_die(CRITICAL_ERROR, "Could not query config information", "", __LINE__, __FILE__, $sql);
}

while ( $row = $db->sql_fetchrow($result) )
{
	$board_config[$row['config_name']] = $row['config_value'];
}
*/
//-- add
// include basic classes def
include($phpbb_root_path . 'includes/class_config.' . $phpEx);
#
#-----[ FIND ]------------------------------------------------
#
if ( !defined('IN_LOGIN') && !defined('IN_INSTALL') && (($config->data['mod_cat_hierarchy'] != '2.1.0f') || defined('RUN_CH_INSTALL')) )
#
#-----[ REPLACE WITH ]----------------------------------------
#
if ( !defined('IN_LOGIN') && !defined('IN_INSTALL') && (($config->data['mod_cat_hierarchy'] != CH_CURRENT_VERSION) || defined('RUN_CH_INSTALL')) )
#
#-----[ FIND ]------------------------------------------------
#
// user objects
#
#-----[ AFTER, ADD ]------------------------------------------
#
include($config->url('includes/class_groups'));
#
#-----[ FIND ]------------------------------------------------
#
$smilies = new smilies();
#
#-----[ AFTER, ADD ]------------------------------------------
#
$topics_attr = new topics_attr();
#
#-----[ FIND ]------------------------------------------------
#
if ( file_exists('install_cat') && !defined('IN_LOGIN') && !defined('IN_INSTALL') )
#
#-----[ REPLACE WITH ]----------------------------------------
#
if ( !defined('IN_LOGIN') && !defined('IN_INSTALL') && file_exists('install_cat') )
#
#-----[ FIND ]------------------------------------------------
#

// messages queue
$message_queue = '';
@include($config->url('includes/class_message'));
$message_queue = !defined('CH_message_queue') ? '' : new message_queue();
#
#-----[ REPLACE WITH ]----------------------------------------
#
// messages queue
@include($config->url('includes/class_message'));
$message_queue = defined('CH_message_queue') ? new message_queue() : '';
#
#-----[ FIND ]------------------------------------------------
#
if( $board_config['board_disable'] && !defined("IN_ADMIN") && !defined("IN_LOGIN") )
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
if( $config->data['board_disable'] && !defined('IN_ADMIN') && !defined('IN_LOGIN') && !defined('IN_INSTALL') )
//-- fin mod : categories hierarchy ---------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
				'U_FAQ_LINK' => '#' . $faq_block[$i][$j]['id'])
			);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				'U_FAQ_LINK' => '#' . $faq_block[$i][$j]['id'],
				'U_FAQ_ID' => $faq_block[$i][$j]['id'],
			));
			$template->set_switch('faq_block.faq_row.light', !($j % 2));
			$template->set_switch('faq_block_link.faq_row_link.light', !($j % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
groupcp.php
#
#-----[ FIND ]------------------------------------------------
#
			if ( $is_moderator )
			{
				$template->assign_block_vars('member_row.switch_mod_option', array());
			}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->set_switch('member_row.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					'U_VIEWPROFILE' => append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . "=$user_id"))
				);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$template->set_switch('pending_members_row.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
memberlist.php
#
#-----[ FIND ]------------------------------------------------
#
			'U_VIEWPROFILE' => append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . "=$user_id"))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('memberrow.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$sql = "SELECT count(*) AS total
		FROM " . USERS_TABLE . "
		WHERE user_id <> " . ANONYMOUS;
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	if ( !empty($sql_join) )
	{
		$sql = str_replace('FROM ' . USERS_TABLE, 'FROM ' . USERS_TABLE . $sql_join, $sql);
	}
	if ( !empty($sql_where) )
	{
		$sql = str_replace('WHERE ', 'WHERE ' . $sql_where, $sql);
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
modcp.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fix : post tag missing ----------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
include($config->url('includes/class_forums'));
include($config->url('includes/class_topics'));
$forums = new forums();
$forums->read();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
include($config->url('includes/class_forums'));
include($config->url('includes/class_topics'));

class topics_modcp extends topics
{
	function bottom_line($empty=false)
	{
		global $template, $user;

		$template->set_switch('topicrow');
		$template->set_switch('topicrow.bottom');
		$template->set_switch('topicrow.bottom.select', $this->with_select);
		$template->set_switch('topicrow.bottom.no_topics', $empty);
		if ( $empty )
		{
			$template->set_switch('topicrow.bottom.no_topics.select', $this->with_select);
		}
		else
		{
			$template->set_switch('topicrow.bottom.no_topics_ELSE.select', $this->with_select);
		}
		$template->assign_vars(array(
			'L_SELECT' => $user->lang('Select'),
			'L_DELETE' => $user->lang('Delete'),
			'L_MOVE' => $user->lang('Move'),
			'L_LOCK' => $user->lang('Lock'),
			'L_UNLOCK' => $user->lang('Unlock'),
		));
		$template->set_filenames(array('bottom_row' => 'topics_bottom_modcp.tpl'));
		$template->assign_var_from_handle('BOTTOM_ROW', 'bottom_row');
	}
}

$forums = new forums();
$forums->read();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$template->assign_vars(array(
	'U_MOD_CP' => $config->url('modcp', array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id'])),
	'L_MOD_CP' => $user->lang('Mod_CP'),
	)
);
$user->get_cache(array(POST_FORUM_URL, POST_FORUM_URL . 'jbox'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$template->assign_vars(array(
	'U_MOD_CP' => $config->url('modcp', array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true),
	'L_MOD_CP' => $user->lang('Mod_CP'),
	'I_POST' => $user->img('icon_minipost'),
));
$user->get_cache(array(POST_FORUM_URL, POST_FORUM_URL . 'jbox'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//	else if ( $forum_id )
//	{
//		$redirect = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id";
//	}
//	else
//	{
//		$redirect = "index.$phpEx";
//	}
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
	else if ( $forum_id )
	{
		$redirect = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id";
	}
	else
	{
		$redirect = "index.$phpEx";
	}
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//				$redirect_page = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
//-- add
				$redirect_page = $config->url('index', array(POST_FORUM_URL => $forum_id, 'sid' => $userdata['session_id']));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
				$redirect_page = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
*/
//-- add
				$redirect_page = $config->url('index', array(POST_FORUM_URL => $forum_id, 'sid' => $userdata['session_id']), true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			if ( $forums->data[$new_forum_id]['forum_type'] != POST_FORUM_URL )
			{
				$l_link = 'Click_return_modcp';
				$u_link = $config->url('modcp', array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']));
				message_return('Move_to_forum_error', $l_link, $u_link, 10);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			if ( $forums->data[$new_forum_id]['forum_type'] != POST_FORUM_URL )
			{
				$l_link = 'Click_return_modcp';
				$u_link = $config->url('modcp', array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
				message_return('Move_to_forum_error', $l_link, $u_link, 10);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//				sync('forum', $old_forum_id);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
				sync('forum', $old_forum_id);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//			$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$old_forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
//-- add
			$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . $config->url('index', array(POST_FORUM_URL => $old_forum_id, 'sid' => $userdata['session_id'])) . '">', '</a>');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
			$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$old_forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
*/
//-- add
			$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . $config->url('index', array(POST_FORUM_URL => $old_forum_id, 'sid' => $userdata['session_id']), true) . '">', '</a>');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
//-- add
		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . $config->url('index', array(POST_FORUM_URL => $forum_id, 'sid' => $userdata['session_id'])) . '">', '</a>');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
*/
//-- add
		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . $config->url('index', array(POST_FORUM_URL => $forum_id, 'sid' => $userdata['session_id']), true) . '">', '</a>');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
//-- add
		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . $config->url('index', array(POST_FORUM_URL => $forum_id, 'sid' => $userdata['session_id'])) . '">', '</a>');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
*/
//-- add
		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . $config->url('index', array(POST_FORUM_URL => $forum_id, 'sid' => $userdata['session_id']), true) . '">', '</a>');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				if ( $forums->data[$new_forum_id]['forum_type'] != POST_FORUM_URL )
				{
					$l_link = 'Click_return_modcp';
					$u_link = $config->url('modcp', array('mode' => 'split', POST_FORUM_URL => $forum_id, POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']));
					message_return('Move_to_forum_error', $l_link, $u_link, 10);
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				if ( $forums->data[$new_forum_id]['forum_type'] != POST_FORUM_URL )
				{
					$l_link = 'Click_return_modcp';
					$u_link = $config->url('modcp', array('mode' => 'split', POST_FORUM_URL => $forum_id, POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']), true);
					message_return('Move_to_forum_error', $l_link, $u_link, 10);
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//				sync('forum', $forum_id);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
				sync('forum', $forum_id);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//					'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"), 
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
					'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"), 
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
						'POST_ID' => $post_id,
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- fix : post tag missing ----------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
						'U_POST_ID' => $post_id,
//-- fin fix : post tag missing ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
						'S_SPLIT_CHECKBOX' => $checkbox)
					);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
					$template->set_switch('postrow.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					'U_LOOKUP_IP' => "modcp.$phpEx?mode=ip&amp;" . POST_POST_URL . "=$post_id&amp;" . POST_TOPIC_URL . "=$topic_id&amp;rdns=" . $row['poster_ip'] . "&amp;sid=" . $userdata['session_id'])
				);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$template->set_switch('iprow.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$topics = new topics('modcp', array('sid' => $user->data['session_id']), 'modcp');
		$topics->extra_parms = array('mode' => 'split', 'sid' => $user->data['session_id']);

		// read topics keeping only local announces
		$topics->read($forum_id, true);

		$upper_box = false;
		$display_empty = true;
		$topics->display($upper_box, $display_empty);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$topics = new topics_modcp('modcp', array('sid' => $user->data['session_id']), 'modcp', true);
		$topics->extra_parms = array('mode' => 'split', 'sid' => $user->data['session_id']);

		// read topics keeping only local announces
		$topics->read($forum_id, true);
		$topics->display(false, true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//			'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"), 
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
			'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"), 
*/
//-- add
#
#-----[ OPEN ]------------------------------------------------
#
posting.php
#
#-----[ FIND ]------------------------------------------------
#
$forums = new forums();
$forums->read();
#
#-----[ AFTER, ADD ]------------------------------------------
#

// pic buttons
$_params = array('post', 'preview', 'confirm', 'cancel', 'delete', 'poll_delete', 'add_poll_option');
$count__params = count($_params);
for ( $i = 0; $i < $count__params; $i++ )
{
	_button($_params[$i]);
}
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//		$redirect = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id";
//-- add
		$redirect = $config->url('index', array(POST_FORUM_URL => $forum_id));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
		$redirect = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id";
*/
//-- add
		$redirect = $config->url('index', array(POST_FORUM_URL => $forum_id), true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
// if ( $result = $db->sql_query($sql) )
// {
//	$post_info = $db->sql_fetchrow($result);
//	$db->sql_freeresult($result);
//
//	$forum_id = $post_info['forum_id'];
//	$forum_name = $post_info['forum_name'];
//
//	$is_auth = auth(AUTH_ALL, $forum_id, $userdata, $post_info);
//-- add
$user->get_cache(array(POST_FORUM_URL, POST_FORUM_URL . 'jbox'));
if ( $mode == 'newtopic' )
{
	$post_info['forum_id'] = intval($forum_id);
}
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
if ( $result = $db->sql_query($sql) )
{
	$post_info = $db->sql_fetchrow($result);
	$db->sql_freeresult($result);

	$forum_id = $post_info['forum_id'];
	$forum_name = $post_info['forum_name'];

	$is_auth = auth(AUTH_ALL, $forum_id, $userdata, $post_info);
*/
//-- add
$user->get_cache(array(POST_FORUM_URL, POST_FORUM_URL . 'jbox'));
if ( $mode == 'newtopic' )
{
	$post_info['forum_id'] = intval($forum_id);
	if ( empty($forum_id) || !isset($forums->data[ intval($forum_id) ]) || ($forums->data[ intval($forum_id) ]['forum_type'] != POST_FORUM_URL) )
	{
		message_die(GENERAL_MESSAGE, $lang['Move_to_forum_error']);
	}
}
#
#-----[ FIND ]------------------------------------------------
#
	// added fields from topic
	$added_sql = 't.topic_icon, t.topic_duration, t.topic_time, t.topic_sub_title';
	if ( defined('POST_CALENDAR') )
#
#-----[ REPLACE WITH ]----------------------------------------
#
	// added fields from topic
	$added_sql = 't.topic_sub_type, t.topic_icon, t.topic_duration, t.topic_time, t.topic_sub_title';
	if ( in_array($mode, array('editpost', 'delete', 'poll_delete')) )
	{
		$added_sql .= ', p.poster_ip';
	}
	if ( ($mode == 'reply') && !strpos(' ' . $sql, ', t.topic_last_post_id') )
	{
		$added_sql .= ', t.topic_last_post_id';
	}
	if ( $config->data['mod_topic_calendar_CH'] )
#
#-----[ FIND ]------------------------------------------------
#
	// read
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	if ( !($post_info = $db->sql_fetchrow($result)) )
	{
		message_die(GENERAL_MESSAGE, $lang['No_such_post']);
	}
	$db->sql_freeresult($result);
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

$topic_last_post_id = intval($post_info['topic_last_post_id']);
if ( ($submit || $refresh) && in_array($mode, array('reply', 'quote', 'editpost')) )
{
	// check if the last post id is still the same
	if ( _read('last_post', TYPE_INT, $topic_last_post_id) != $topic_last_post_id )
	{
		$refresh = $preview = true;
		$submit = false;
		_error($mode == 'editpost' ? 'New_post_meanwhile_edit' : 'New_post_meanwhile_reply');
	}
}
#
#-----[ FIND ]------------------------------------------------
#
		//
		// Can this user edit/delete the post/poll?
		//
		if ( $post_info['poster_id'] != $userdata['user_id'] && !$is_auth['auth_mod'] )
		{
			$message = ( $delete || $mode == 'delete' ) ? $lang['Delete_own_posts'] : $lang['Edit_own_posts'];
			$message .= '<br /><br />' . sprintf($lang['Click_return_topic'], '<a href="' . append_sid("viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id") . '">', '</a>');

			message_die(GENERAL_MESSAGE, $message);
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		else if ( !$user->data['session_logged_in'] && ($user->data['session_ip'] != $post_info['poster_ip']) && !$user->auth(POST_FORUM_URL, 'auth_mod', $forum_id) )
		{
			message_return(($delete || ($mode == 'delete')) ? 'Delete_own_posts' : 'Edit_own_posts', 'Click_return_topic', $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id), true));
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//		message_die(GENERAL_MESSAGE, sprintf($lang['Sorry_' . $is_auth_type], $is_auth[$is_auth_type . "_type"]));
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
		message_die(GENERAL_MESSAGE, sprintf($lang['Sorry_' . $is_auth_type], $is_auth[$is_auth_type . "_type"]));
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
// get auths
$auth_calendar = defined('POST_CALENDAR') && $user->auth(POST_FORUM_URL, 'auth_calendar', $forum_id);
#
#-----[ REPLACE WITH ]----------------------------------------
#
// get auths
$auth_calendar = $config->data['mod_topic_calendar_CH'] && $user->auth(POST_FORUM_URL, 'auth_calendar', $forum_id);
#
#-----[ FIND ]------------------------------------------------
#
$topic_duration = ($post_data['first_post'] || ($mode == 'newtopic')) ? (!empty($post_info['topic_time']) && $auth_announces ? $post_info['topic_time'] : time()) : 0;
#
#-----[ AFTER, ADD ]------------------------------------------
#

// topic sub type
$topics_attr->read();
$topics_attr->get_allowed('topic_sub_type', $forum_id);
$topic_sub_type = ($post_data['first_post'] || ($mode == 'newtopic')) && !empty($post_info['topic_sub_type']) ? intval($post_info['topic_sub_type']) : 0;
#
#-----[ FIND ]------------------------------------------------
#
	//
	// calendar events
	//
	if ( $auth_calendar )
	{
		$fields += array(
			'calendar_title' => array('type' => 'title', 'legend' => 'Calendar_event'),
			'calendar_title_explain' => array('type' => 'comment_light', 'legend' => 'Calendar_event_explain'),
			'calendar_time' => array('type' => 'timestamp', 'legend' => 'Calendar_time', 'value' => intval($post_info['topic_calendar_time']), 'bold' => true),
			'calendar_stop' => array('type' => 'timestamp', 'legend' => 'Calendar_stop', 'value' => empty($post_info['topic_calendar_duration']) ? 0 : intval($post_info['topic_calendar_time']) + intval($post_info['topic_calendar_duration']), 'options.end_date' => true, 'bold' => true),
		);
	}
#
#-----[ REPLACE WITH ]----------------------------------------
#
	// topic sub type
	if ( count($topics_attr->allowed) > 1 )
	{
		$fields += array(
			'topic_sub_type' => array('type' => 'list', 'legend' => 'Topic_sub_type', 'value' => $topic_sub_type, 'options' => $topics_attr->allowed, 'bold' => true),
		);
	}

	//
	// calendar events
	//
	if ( $auth_calendar )
	{
		$calendar_time = intval($post_info['topic_calendar_time']);
		$calendar_stop = empty($post_info['topic_calendar_duration']) ? 0 : intval($post_info['topic_calendar_time']) + intval($post_info['topic_calendar_duration']);
		$calendar_time = empty($calendar_time) ? 0 : $user->cvt_sys_to_user_date($calendar_time);
		$calendar_stop = empty($calendar_stop) ? 0 : $user->cvt_sys_to_user_date($calendar_stop);
		$fields += array(
			'calendar_title' => array('type' => 'title', 'legend' => 'Calendar_event'),
			'calendar_title_explain' => array('type' => 'comment_light', 'legend' => 'Calendar_event_explain'),
			'calendar_time' => array('type' => 'timestamp', 'legend' => 'Calendar_time', 'value' => $calendar_time, 'bold' => true),
			'calendar_stop' => array('type' => 'timestamp', 'legend' => 'Calendar_stop', 'value' => $calendar_stop, 'options.end_date' => true, 'bold' => true),
		);
	}
#
#-----[ FIND ]------------------------------------------------
#
			$topic_duration = time() + intval($config->data['default_duration']) * 86400;
#
#-----[ REPLACE WITH ]----------------------------------------
#
			$topic_duration = $user->cvt_sys_to_user_date(time() + intval($config->data['default_duration']) * 86400);
#
#-----[ FIND ]------------------------------------------------
#
			$topic_duration = intval($post_info['topic_duration']);
#
#-----[ REPLACE WITH ]----------------------------------------
#
			$topic_duration = $user->cvt_sys_to_user_date(intval($post_info['topic_duration']));
#
#-----[ FIND ]------------------------------------------------
#
			'topic_duration' => array('type' => 'date_unix', 'legend' => 'Topic_duration', 'value' => $topic_duration, 'options.specials' => array(-1 => 'Never_displayed', 0 => 'Always_displayed'), 'options.floor' => time(), 'options.end_date' => true, 'bold' => true),
#
#-----[ REPLACE WITH ]----------------------------------------
#
			'topic_duration' => array('type' => 'date_unix', 'legend' => 'Topic_duration', 'value' => $topic_duration, 'options.specials' => array(-1 => 'Never_displayed', 0 => 'Always_displayed'), 'options.floor' => $user->cvt_sys_to_user_date(time()), 'options.end_date' => true, 'bold' => true),
#
#-----[ FIND ]------------------------------------------------
#
		if ( $calendar_time <= 0 )
		{
			$calendar_time = 0;
		}
		if ( $calendar_stop <= 0 )
		{
			$calendar_duration = 0;
		}
		else if ( empty($calendar_time) || ($calendar_time >= $calendar_stop) )
		{
			_error('Calendar_date_not_valid');
		}
		else
		{
			$calendar_duration = $calendar_stop - $calendar_time;
		}
#
#-----[ REPLACE WITH ]----------------------------------------
#
		$calendar_time = ($calendar_time <= 0) ? 0 : $user->cvt_user_to_sys_date($calendar_time);
		$calendar_stop = ($calendar_stop <= 0) ? 0 : $user->cvt_user_to_sys_date($calendar_stop);

		$calendar_duration = 0;
		if ( ($calendar_stop > 0) && (($calendar_time == 0) || ($calendar_time >= $calendar_stop)) )
		{
			_error('Calendar_date_not_valid');
		}
		else if ( $calendar_time > 0 )
		{
			$calendar_duration = max(0, $calendar_stop - $calendar_time);
		}
#
#-----[ FIND ]------------------------------------------------
#
	//
	// post process announces part
	//
	if ( $auth_announces && isset($posting_form->fields['topic_duration']) )
	{
		// get topic duration
		$topic_duration = $posting_form->fields['topic_duration']->value;
		if ( ($topic_duration < 0) || !in_array($topic_type, $types_with_duration) )
		{
			$topic_duration = empty($post_info['topic_time']) ? time() : $post_info['topic_time'];
		}
	}
#
#-----[ REPLACE WITH ]----------------------------------------
#
	//
	// post process announces part
	//
	if ( $auth_announces && isset($posting_form->fields['topic_duration']) )
	{
		// get topic duration
		$topic_duration = $posting_form->fields['topic_duration']->value;
		if ( ($topic_duration < 0) || !in_array($topic_type, $types_with_duration) )
		{
			$topic_duration = empty($post_info['topic_time']) ? time() : $post_info['topic_time'];
		}
		else if ( $topic_duration > 0 )
		{
			$topic_duration = $user->cvt_user_to_sys_date($topic_duration);
		}
	}
	
	// topic sub type
	$topic_sub_type = ($post_data['first_post'] || ($mode == 'newtopic')) && isset($posting_form->fields['topic_sub_type']) ? intval($posting_form->fields['topic_sub_type']->value) : 0;
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy --------------------------------------------------------------------
//-- modify
// here we added
//	, $post_icon, $topic_duration, $calendar_time, $calendar_duration, $sub_title
//-- modify
				submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $topic_type, $bbcode_on, $html_on, $smilies_on, $attach_sig, $bbcode_uid, str_replace("\'", "''", $username), str_replace("\'", "''", $subject), str_replace("\'", "''", $message), str_replace("\'", "''", $poll_title), $poll_options, $poll_length, $post_icon, $topic_duration, $calendar_time, $calendar_duration, $sub_title);
//-- fin mod : categories hierarchy ----------------------------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy --------------------------------------------------------------------
//-- delete
/*
				submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $topic_type, $bbcode_on, $html_on, $smilies_on, $attach_sig, $bbcode_uid, str_replace("\'", "''", $username), str_replace("\'", "''", $subject), str_replace("\'", "''", $message), str_replace("\'", "''", $poll_title), $poll_options, $poll_length);
*/
//-- add
				$input_data = array(
					'topic_type' => $topic_type,
					'bbcode_on' => $bbcode_on,
					'html_on' => $html_on,
					'smilies_on' => $smilies_on,
					'attach_sig' => $attach_sig,
					'bbcode_uid' => $bbcode_uid,
					'post_username' => str_replace("\'", "''", $username),
					'post_subject' => str_replace("\'", "''", $subject),
					'post_message' => str_replace("\'", "''", $message),
					'poll_title' => str_replace("\'", "''", $poll_title),
					'poll_options' => $poll_options,
					'poll_length' => $poll_length,
					'post_icon' => $post_icon,
					'topic_duration' => $topic_duration,
					'calendar_time' => $calendar_time,
					'calendar_duration' => $calendar_duration,
					'sub_title' => $sub_title,
					'topic_sub_type' => $topic_sub_type,
				);
				submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $input_data);
				unset($input_data);
//-- fin mod : categories hierarchy ----------------------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		// message icon
		$icons->topic_title('', $post_icon, ($post_data['first_post'] || ($mode == 'newtopic')) ? (($topic_type > POST_NORMAL) ? $topic_type : ($calendar_time ? POST_CALENDAR : '')) : '');

		// sub title
		$front_sub_title = new front_sub_title();
		$front_sub_title->topic_title('', $sub_title, $sub_title_display);
		unset($front_sub_title);

		// first post of the topic, get additional information for the subject
		if ( $post_data['first_post'] || ($mode == 'newtopic') )
		{
			// announce
			$front_announce = new front_announce();
			$front_announce->topic_title('', $post_info['topic_time'], $topic_duration);
			unset($front_announce);

			// calendar
			$front_calendar = new front_calendar();
			$front_calendar->topic_title('', $calendar_time, $calendar_duration);
			unset($front_calendar);
		}

		// let's send remaining messages : preview is the place :)
		if ( !empty($error_msg) )
		{
			$template->set_filenames(array(
				'reg_header' => 'error_body.tpl')
			);
			$template->assign_vars(array(
				'ERROR_MESSAGE' => $error_msg)
			);
			$template->assign_var_from_handle('ERROR_BOX', 'reg_header');
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		// build a row
		$title_row = array_merge($post_info, array(
			'topic_type' => $topic_type,
			'topic_sub_type' => $topic_sub_type,
			'topic_duration' => $topic_duration,
			'topic_calendar_time' => $calendar_time,
			'topic_calendar_duration' => $calendar_duration,
			'post_icon' => $post_icon,
			'post_sub_title' => $sub_title,
			'topic_sub_title' => ($post_data['first_post'] || ($mode == 'newtopic')) ? $sub_title : $post_info['topic_sub_title'],
		));

		// enhance the topic title
		$front_title = new front_title();
		$front_title->set('', $title_row, $post_data['first_post'] || ($mode == 'newtopic'));

		// let's send remaining messages : preview is the place :)
		if ( !empty($error_msg) )
		{
			$template->set_filenames(array('reg_header' => 'error_body.tpl'));
			$template->assign_vars(array('ERROR_MESSAGE' => $error_msg));
			$template->assign_var_from_handle('ERROR_BOX', 'reg_header');
		}
		$template->assign_vars(array(
			'I_POST' => $user->img('icon_minipost'),
		));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//	'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"))
//-- add
	'U_VIEW_FORUM' => $config->url('index', array(POST_FORUM_URL => $forum_id), true),
	)
//-- fin mod : categories hierarchy --------------------------------------------
);
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
	'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"))
);
*/
//-- add
	'U_VIEW_FORUM' => $config->url('index', array(POST_FORUM_URL => $forum_id), true),
));
$hidden_form_fields .= '<input type="hidden" name="last_post" value = "' . $topic_last_post_id . '" />';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	// note : all of this has been copied into includes/bbcode.tpl, function display_bbcodes()
#
#-----[ REPLACE WITH ]----------------------------------------
#
	// note : all of this has been copied into includes/bbcode.php, function display_bbcodes()
#
#-----[ FIND ]------------------------------------------------
#
// send the name of the topic if any, else send forum name
$template->assign_vars(array(
	'U_TITLE' => ($mode == 'newtopic') ? $config->url('index', array(POST_FORUM_URL => $forum_id), true) : $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id), true),
	'TITLE' => ($mode == 'newtopic') ? $forum_name : _censor($post_info['topic_title']),
	)
);
#
#-----[ REPLACE WITH ]----------------------------------------
#
// send the name of the topic if any, else send forum name
$template->assign_vars(array(
	'U_TITLE' => ($mode == 'newtopic') ? $config->url('index', array(POST_FORUM_URL => $forum_id), true) : $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id), true),
	'TITLE' => ($mode == 'newtopic') ? $forum_name : _censor($post_info['topic_title']),
	'I_SUBMIT' => $user->img('cmd_submit'),
	'I_PREVIEW' => $user->img('cmd_preview'),
	'I_CANCEL' => $user->img('cmd_cancel'),
));
#
#-----[ OPEN ]------------------------------------------------
#
privmsg.php
#
#-----[ FIND ]------------------------------------------------
#
//
// Parameters
//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
// pic buttons
$_params = array('post', 'preview', 'confirm', 'cancel', 'delete', 'usersubmit', 'submit_msgdays', 'deleteall', 'save');
$count__params = count($_params);
for ( $i = 0; $i < $count__params; $i++ )
{
	_button($_params[$i]);
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$template->assign_vars(array(
	'SUBJECT_LENGTH' => intval($config->data['topic_title_length']),
));
#
#-----[ REPLACE WITH ]----------------------------------------
#
$template->assign_vars(array(
	'I_SUBMIT' => $user->img('cmd_submit'),
	'I_PREVIEW' => $user->img('cmd_preview'),
	'I_CANCEL' => $user->img('cmd_cancel'),
	'SUBJECT_LENGTH' => intval($config->data['topic_title_length']),

	'U_INBOX' => $config->url('privmsg', array('folder' => 'inbox'), true),
	'L_INBOX' => $user->lang('Inbox'),
	'I_INBOX' => $user->img('pm_inbox'),
	'U_OUTBOX' => $config->url('privmsg', array('folder' => 'outbox'), true),
	'L_OUTBOX' => $user->lang('Outbox'),
	'I_OUTBOX' => $user->img('pm_outbox'),
	'U_SENTBOX' => $config->url('privmsg', array('folder' => 'sentbox'), true),
	'L_SENTBOX' => $user->lang('Sentbox'),
	'I_SENTBOX' => $user->img('pm_sentbox'),
	'U_SAVEBOX' => $config->url('privmsg', array('folder' => 'savebox'), true),
	'L_SAVEBOX' => $user->lang('Savebox'),
	'I_SAVEBOX' => $user->img('pm_savebox'),
));
$template->set_switch('inbox', ($folder == 'inbox') || empty($folder));
$template->set_switch('outbox', ($folder == 'outbox'));
$template->set_switch('sentbox', ($folder == 'sentbox'));
$template->set_switch('savebox', ($folder == 'savebox'));
#
#-----[ FIND ]------------------------------------------------
#
		// note : all of this has been copied into includes/bbcode.tpl, function display_bbcodes()
#
#-----[ REPLACE WITH ]----------------------------------------
#
		// note : all of this has been copied into includes/bbcode.php, function display_bbcodes()
#
#-----[ FIND ]------------------------------------------------
#
			'U_FROM_USER_PROFILE' => $u_from_user_profile)
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('listrow.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
profile.php
#
#-----[ FIND ]------------------------------------------------
#
$navigation->display();
#
#-----[ AFTER, ADD ]------------------------------------------
#

// pic buttons
_button('submit');
$template->assign_vars(array(
	'I_SUBMIT' => $user->img('cmd_submit'),
	'S_SUBMIT' => $user->lang('cmd_submit'),
));
#
#-----[ OPEN ]------------------------------------------------
#
search.php
#
#-----[ FIND ]------------------------------------------------
#
if ( !$searchuser )
{
	$user->get_cache(POST_FORUM_URL);
	$navigation = new navigation();
	$navigation->add('Search', '', 'search', array('mode' => _read('mode', TYPE_NO_HTML)), '');
	$navigation->display();
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

// topics class
include($config->url('includes/class_topics'));
class topics_search extends topics
{
	function topics_search($parms='', $extra_parms='')
	{
		parent::topics('search', $parms);
		$this->extra_parms = empty($extra_parms) ? array() : $extra_parms;
	}

	function read(&$search_results, $total_match_count)
	{
		global $db, $user;

		$this->forum_id = 0;
		$this->total_topics = $total_match_count;
		$start = $this->parms['start'];
		$ppage = $this->parms['ppage'];

		// read topics
		$sql = 'SELECT *
					FROM ' . TOPICS_TABLE . '
					WHERE topic_id IN(' . $search_results . ')
					ORDER BY topic_last_time DESC
					LIMIT ' . $start . ', ' . $ppage;

		// read results
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		$this->pre_process();
		while ( $row = $db->sql_fetchrow($result) )
		{
			$this->row_process($row);
			$this->data_ext[ $row['topic_id'] ] = $row;
		}
		$db->sql_freeresult($result);

		// get complementary data
		$this->post_process();
	}

	function bottom_line($empty=false)
	{
		global $template, $user;

		$template->set_switch('topicrow');
		$template->set_switch('topicrow.bottom');
		$template->set_switch('topicrow.bottom.no_topics', $empty);
		$template->set_filenames(array('bottom_row' => 'topics_bottom_search.tpl'));
		$template->assign_var_from_handle('BOTTOM_ROW', 'bottom_row');
	}
}
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//				if ( $userdata['session_logged_in'] )
//				{
//					$sql = "SELECT post_id 
//						FROM " . POSTS_TABLE . " 
//						WHERE post_time >= " . $userdata['user_lastvisit'];
//				}
//				else
//				{
//					redirect(append_sid("login.$phpEx?redirect=search.$phpEx&search_id=newposts", true));
//				}
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
				if ( $userdata['session_logged_in'] )
				{
					$sql = "SELECT post_id 
						FROM " . POSTS_TABLE . " 
						WHERE post_time >= " . $userdata['user_lastvisit'];
				}
				else
				{
					redirect(append_sid("login.$phpEx?redirect=search.$phpEx&search_id=newposts", true));
				}
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
			if ( $search_id != 'newposts' )
			{
//-- fin mod : categories hierarchy --------------------------------------------

			if ( !($result = $db->sql_query($sql)) )
#
#-----[ REPLACE WITH ]----------------------------------------
#
			if ( $search_id != 'newposts' )
			{
//-- fin mod : categories hierarchy --------------------------------------------
			if ( !($result = $db->sql_query($sql)) )
#
#-----[ FIND ]------------------------------------------------
#
	// display results as topics
	if ( $show_results == 'topics' )
	{
		// topics class
		include($config->url('includes/class_topics'));
		$topics = new topics('search');

		// read topics
		// -----------
		// t is topic
		// u is topic author
		// ul is last post author
		$sql = 'SELECT t.*, u.username, ul.username AS last_post_username
					FROM ' . TOPICS_TABLE . ' t
						LEFT JOIN ' . USERS_TABLE . ' u ON u.user_id = t.topic_poster
						LEFT JOIN ' . USERS_TABLE . ' ul ON ul.user_id = t.topic_last_poster
					WHERE topic_id IN(' . $search_results . ')';

		// filter page and order
		$ppage = _read('ppage', TYPE_INT);
		$per_page = $ppage ? $ppage : (intval($user->data['user_topics_ppage']) ? intval($user->data['user_topics_ppage']) : (intval($config->data['topics_per_page']) ? intval($config->data['topics_per_page']) : 50));
		$sql .= ' ORDER BY ';
		switch ( $sort_by )
		{
			case 1:
				$sql .= 't.topic_title';
				break;
			case 2:
				$sql .= 't.topic_title';
				break;
			case 3:
				$sql .= 'u.username';
				break;
			case 4:
				$sql .= 't.forum_id';
				break;
			default:
				$sql .= 't.topic_last_time';
				break;
		}
		$sql .= ' ' . $sort_dir . ' LIMIT ' . intval($start) . ', ' . $per_page;
		$topics->parms = array(
			'sort' => $sort_by,
			'order' => $sort_dir,
			'start' => $start,
			'ppage' => $per_page,
			'search_id' => intval($search_id),
		);
		$topics->total_topics = $total_match_count;

		// get highlight parm
		$highlight_active = '';
		$highlight_match = array();
		for($j = 0; $j < count($split_search); $j++ )
		{
			$split_word = $split_search[$j];

			if ( $split_word != 'and' && $split_word != 'or' && $split_word != 'not' )
			{
				$highlight_match[] = '#\b(' . str_replace("*", "([\w]+)?", $split_word) . ')\b#is';
				$highlight_active .= " " . $split_word;

				for ($k = 0; $k < count($synonym_array); $k++)
				{ 
					list($replace_synonym, $match_synonym) = split(' ', trim(strtolower($synonym_array[$k]))); 

					if ( $replace_synonym == $split_word )
					{
						$highlight_match[] = '#\b(' . str_replace("*", "([\w]+)?", $replace_synonym) . ')\b#is';
						$highlight_active .= ' ' . $match_synonym;
					}
				} 
			}
		}
		if ( !empty($highlight_active) )
		{
			$topics->extra_parms += array(
				'highlight' => urlencode(trim($highlight_active)),
			);
		}

		// read results
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		while ( $row = $db->sql_fetchrow($result) )
		{
			$row['topic_unread'] = !empty($user->cookies['unreads']) && !empty($user->cookies['unreads'][ $row['topic_id'] ]);
			if ( ($row['topic_poster'] != ANONYMOUS) && !empty($row['username']) )
			{
				$row['topic_first_username'] = $row['username'];
				unset($row['username']);
			}
			if ( ($row['topic_last_poster'] != ANONYMOUS) && !empty($row['last_post_username']) )
			{
				$row['topic_last_username'] = $row['last_post_username'];
				unset($row['username']);
			}
			$topics->data_ext[ $row['topic_id'] ] = $row;
		}
		$db->sql_freeresult($result);

		// search topics the viewer has posted in
		if ( !empty($topics->data_ext) && $user->data['session_logged_in'] )
		{
			$sql = 'SELECT DISTINCT topic_id
						FROM ' . POSTS_TABLE . '
						WHERE poster_id = ' . intval($user->data['user_id']) . '
							AND topic_id IN(' . implode(', ', array_keys($topics->data_ext)) . ')
						GROUP BY topic_id';
			$result = $db->sql_query($sql, false, __LINE__, __FILE__);
			while ( $row = $db->sql_fetchrow($result) )
			{
				// moved topics are selected, so don't add them to the main selection
				if ( isset($topics->data_ext[ $row['topic_id'] ]) )
				{
					$topics->data_ext[ $row['topic_id'] ]['topic_own'] = true;
				}
			}
			$db->sql_freeresult($result);
		}

		// start the page
		$page_title = $user->lang('Search');
		include($config->url('includes/page_header'));

		$template->set_filenames(array('body' => 'search_results_topics.tpl'));

		// jumpbox
		make_jumpbox('index');

		// constants
		$l_search_matches = ( $total_match_count == 1 ) ? sprintf($user->lang('Found_search_match'), $total_match_count) : sprintf($user->lang('Found_search_matches'), $total_match_count);
		$template->assign_vars(array(
			'L_SEARCH_MATCHES' => $l_search_matches, 
			'L_TOPIC' => $user->lang('Topic'),
		));

		// upper box (so with forum nav sentence for each topic), force display empty
		$upper_box = true;
		$display_empty = true;
		$topics->display($upper_box, $display_empty);

		// display
		$template->pparse('body');
		include($config->url('includes/page_tail'));
		exit;
	}
#
#-----[ REPLACE WITH ]----------------------------------------
#
	// display results as topics
	if ( $show_results == 'topics' )
	{
		// get highlight parm
		$highlight_active = '';
		$highlight_match = array();
		for($j = 0; $j < count($split_search); $j++ )
		{
			$split_word = $split_search[$j];

			if ( $split_word != 'and' && $split_word != 'or' && $split_word != 'not' )
			{
				$highlight_match[] = '#\b(' . str_replace("*", "([\w]+)?", $split_word) . ')\b#is';
				$highlight_active .= " " . $split_word;

				for ($k = 0; $k < count($synonym_array); $k++)
				{ 
					list($replace_synonym, $match_synonym) = split(' ', trim(strtolower($synonym_array[$k]))); 

					if ( $replace_synonym == $split_word )
					{
						$highlight_match[] = '#\b(' . str_replace("*", "([\w]+)?", $replace_synonym) . ')\b#is';
						$highlight_active .= ' ' . $match_synonym;
					}
				} 
			}
		}
		$extra_parms = empty($highlight_active) ? '' : array('highlight' => urlencode(trim($highlight_active)));

		// filter page and order
		$start = max(0, _read('start', TYPE_INT));
		$ppage = _read('ppage', TYPE_INT);
		$ppage = ($ppage > 0) ? $ppage : (intval($user->data['user_topics_ppage']) ? intval($user->data['user_topics_ppage']) : (intval($config->data['topics_per_page']) ? intval($config->data['topics_per_page']) : 50));
		$parms = array(
			'sort' => '',
			'order' => '',
			'topicdays' => 0,
			'start' => $start,
			'ppage' => $ppage,
			'search_id' => intval($search_id),
		);

		$topics = new topics_search($parms, $extra_parms);
		$topics->read($search_results, $total_match_count);

		// start the page
		$page_title = $user->lang('Search');
		include($config->url('includes/page_header'));

		// jumpbox
		make_jumpbox('index');

		// constants
		$l_search_matches = ( $total_match_count == 1 ) ? sprintf($user->lang('Found_search_match'), $total_match_count) : sprintf($user->lang('Found_search_matches'), $total_match_count);
		$template->assign_vars(array(
			'L_SEARCH_MATCHES' => $l_search_matches,
		));

		// upper box (so with forum nav sentence for each topic), force display empty, force the title
		$topics->display(true, true);

		// display
		$template->set_filenames(array('body' => 'search_results_topics.tpl'));
		$template->pparse('body');
		include($config->url('includes/page_tail'));
		exit;
	}
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//		$tracking_topics = ( isset($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_t']) ) ? unserialize($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_t']) : array();
//		$tracking_forums = ( isset($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_f']) ) ? unserialize($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_f']) : array();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
		$tracking_topics = ( isset($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_t']) ) ? unserialize($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_t']) : array();
		$tracking_forums = ( isset($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_f']) ) ? unserialize($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_f']) : array();
*/
//-- add
		// prepare title enhancement
		$front_title = new front_title();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//			$forum_url = append_sid("viewforum.$phpEx?" . POST_FORUM_URL . '=' . $searchset[$i]['forum_id']);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
			$forum_url = append_sid("viewforum.$phpEx?" . POST_FORUM_URL . '=' . $searchset[$i]['forum_id']);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
				// message icon
				$icons->topic_title('searchresults', $searchset[$i]['post_icon'], ($searchset[$i]['topic_first_post_id'] == $searchset[$i]['post_id']) ? (($searchset[$i]['topic_type'] > POST_NORMAL) ? $searchset[$i]['topic_type'] : ($searchset[$i]['topic_calendar_time'] ? POST_CALENDAR : '')) : '');

				// sub title
				$front_sub_title = new front_sub_title();
				$front_sub_title->topic_title('searchresults', $searchset[$i]['post_sub_title'], intval($config->data['sub_title_length']));
				unset($front_sub_title);

				// first post of the topic, get additional information for the subject
				if ( $searchset[$i]['topic_first_post_id'] == $searchset[$i]['post_id'] )
				{
					// announce
					$front_announce = new front_announce();
					$front_announce->topic_title('searchresults', $searchset[$i]['topic_time'], $searchset[$i]['topic_duration']);
					unset($front_announce);

					// calendar
					$front_calendar = new front_calendar();
					$front_calendar->topic_title('searchresults', $searchset[$i]['topic_calendar_time'], $searchset[$i]['topic_calendar_duration']);
					unset($front_calendar);
				}
#
#-----[ REPLACE WITH ]----------------------------------------
#
				// enhance the topic title
				$front_title->set('searchresults', $searchset[$i], $searchset[$i]['topic_first_post_id'] == $searchset[$i]['post_id'], $highlight_active);
#
#-----[ FIND ]------------------------------------------------
#
		$pagination->display('pagination', $total_match_count, $per_page, $start, true, 'Posts_count');
#
#-----[ AFTER, ADD ]------------------------------------------
#
		$template->assign_vars(array(
			'I_TOPIC' => $user->img('folder'),
		));
#
#-----[ FIND ]------------------------------------------------
#
$template->assign_vars(array(
	'L_SEARCH_FORUM' => $user->lang('Search_in_forum'),
	'L_NO_SUBS' => $user->lang('Search_no_subs'),
	'S_NO_SUBS' => _button('no_subs') ? 'checked="checked"' : '',
	)
);
#
#-----[ REPLACE WITH ]----------------------------------------
#
$template->assign_vars(array(
	'L_SEARCH_FORUM' => $user->lang('Search_in_forum'),
	'L_NO_SUBS' => $user->lang('Search_no_subs'),
	'S_NO_SUBS' => _button('no_subs') ? 'checked="checked"' : '',
	'I_SEARCH_BUTTON' => $user->img('cmd_search'),
));
#
#-----[ OPEN ]------------------------------------------------
#
viewonline.php
#
#-----[ FIND ]------------------------------------------------
#
//-- deleted
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//		if ( $row['session_page'] < 1 || !$is_auth_ary[$row['session_page']]['auth_view'] )
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
		if ( $row['session_page'] < 1 || !$is_auth_ary[$row['session_page']]['auth_view'] )
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//			$location_url = append_sid("viewforum.$phpEx?" . POST_FORUM_URL . '=' . $row['session_page']);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
			$location_url = append_sid("viewforum.$phpEx?" . POST_FORUM_URL . '=' . $row['session_page']);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
			'U_FORUM_LOCATION' => append_sid($location_url))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch($which_row . '.light', !($$which_counter % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
viewtopic.php
#
#-----[ FIND ]------------------------------------------------
#
// added fields
$added_fields = 't.topic_duration, t.topic_first_post_id, t.topic_sub_title, ';
if ( defined('POST_CALENDAR') )
#
#-----[ REPLACE WITH ]----------------------------------------
#
// added fields
$added_fields = 't.topic_sub_type, t.topic_duration, t.topic_first_post_id, t.topic_sub_title, ';
if ( $config->data['mod_topic_calendar_CH'] )
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
// $is_auth = auth(AUTH_ALL, $forum_id, $userdata, $forum_topic_data);
//
// if( !$is_auth['auth_view'] || !$is_auth['auth_read'] )
// {
//	if ( !$userdata['session_logged_in'] )
//	{
//		$redirect = ( isset($post_id) ) ? POST_POST_URL . "=$post_id" : POST_TOPIC_URL . "=$topic_id";
//		$redirect .= ( isset($start) ) ? "&start=$start" : '';
//		redirect(append_sid("login.$phpEx?redirect=viewtopic.$phpEx&$redirect", true));
//	}
//
//	$message = ( !$is_auth['auth_view'] ) ? $lang['Topic_post_not_exist'] : sprintf($lang['Sorry_auth_read'], $is_auth['auth_read_type']);
//
//	message_die(GENERAL_MESSAGE, $message);
// }
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
$is_auth = auth(AUTH_ALL, $forum_id, $userdata, $forum_topic_data);

if( !$is_auth['auth_view'] || !$is_auth['auth_read'] )
{
	if ( !$userdata['session_logged_in'] )
	{
		$redirect = ( isset($post_id) ) ? POST_POST_URL . "=$post_id" : POST_TOPIC_URL . "=$topic_id";
		$redirect .= ( isset($start) ) ? "&start=$start" : '';
		redirect(append_sid("login.$phpEx?redirect=viewtopic.$phpEx&$redirect", true));
	}

	$message = ( !$is_auth['auth_view'] ) ? $lang['Topic_post_not_exist'] : sprintf($lang['Sorry_auth_read'], $is_auth['auth_read_type']);

	message_die(GENERAL_MESSAGE, $message);
}
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
	if ( !$user->data['session_logged_in'] )
	{
		$redirect = empty($post_id) || !empty($start) ? array(POST_TOPIC_URL => $topic_id) : array(POST_POST_URL => $post_id);
		redirect($config->url('viewtopic', $redirect + array('start' => intval($start)), true));
	}
#
#-----[ REPLACE WITH ]----------------------------------------
#
	if ( !$user->data['session_logged_in'] )
	{
		redirect($config->url('login', array('redirect' => str_replace('?', '&', $config->url('viewtopic', empty($post_id) || !empty($start) ? array(POST_TOPIC_URL => $topic_id, 'start' => intval($start)) : array(POST_POST_URL => $post_id, 'start' => intval($start))))), true));
	}
#
#-----[ FIND ]------------------------------------------------
#
	}
	$template->assign_vars(array(
		'I_UNREAD' => $user->img('icon_unmark_read'),
		'L_UNREAD_TOPIC' => $user->lang('Topic_unmark_read'),
		'U_UNREAD_TOPIC' => $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, 'unmark' => 'topic'), true),
		'L_UNREAD_POST' => $user->lang('Post_unmark_read'),
		)
	);
#
#-----[ REPLACE WITH ]----------------------------------------
#
	}
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// $sql = "SELECT *
//	FROM " . RANKS_TABLE . "
//	ORDER BY rank_special, rank_min";
// if ( !($result = $db->sql_query($sql)) )
// {
//	message_die(GENERAL_ERROR, "Could not obtain ranks information.", '', __LINE__, __FILE__, $sql);
// }
//
// $ranksrow = array();
// while ( $row = $db->sql_fetchrow($result) )
// {
//	$ranksrow[] = $row;
// }
// $db->sql_freeresult($result);
//-- add
$ranks = new ranks();
$ranksrow = $ranks->read();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
$sql = "SELECT *
	FROM " . RANKS_TABLE . "
	ORDER BY rank_special, rank_min";
if ( !($result = $db->sql_query($sql)) )
{
	message_die(GENERAL_ERROR, "Could not obtain ranks information.", '', __LINE__, __FILE__, $sql);
}

$ranksrow = array();
while ( $row = $db->sql_fetchrow($result) )
{
	$ranksrow[] = $row;
}
$db->sql_freeresult($result);
*/
//-- add
$ranks = new ranks();
$ranksrow = $ranks->read();

// prepare title enhancement
$front_title = new front_title();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
// $view_forum_url = append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id");
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
$view_forum_url = append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id");
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
$s_auth_can .= ( ( $is_auth['auth_vote'] ) ? $lang['Rules_vote_can'] : $lang['Rules_vote_cannot'] ) . '<br />';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( !empty($config->data['mod_topic_calendar_CH']) )
{
	$s_auth_can .= ($user->auth(POST_FORUM_URL, 'auth_calendar', $forum_id) ? $user->lang('Rules_calendar_can') : $user->lang('Rules_calendar_cannot')) . '<br />';
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				$vote_graphic_img = $images['voting_graphic'][$vote_graphic];
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$vote_graphic_img_left = $images['voting_left'][$vote_graphic];
				$vote_graphic_img_right = $images['voting_right'][$vote_graphic];
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					'POLL_OPTION_IMG' => $vote_graphic_img,
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
					'POLL_OPTION_IMG_LEFT' => $vote_graphic_img_left,
					'POLL_OPTION_IMG_RIGHT' => $vote_graphic_img_right,
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//	if ( $userdata['session_logged_in'] && $postrow[$i]['post_time'] > $userdata['user_lastvisit'] && $postrow[$i]['post_time'] > $topic_last_read )
//-- add
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- delete
/*
	if ( $userdata['session_logged_in'] && $postrow[$i]['post_time'] > $userdata['user_lastvisit'] && $postrow[$i]['post_time'] > $topic_last_read )
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
	if ( ( $userdata['user_id'] == $poster_id && $is_auth['auth_edit'] ) || $is_auth['auth_mod'] )
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( (($user->data['user_id'] == $poster_id) && ($user->data['session_logged_in'] || (!$user->data['session_logged_in'] && ($user->data['session_ip'] == $postrow[$i]['poster_ip']))) && $user->auth(POST_FORUM_URL, 'auth_edit', $forum_id)) || $user->auth(POST_FORUM_URL, 'auth_mod', $forum_id) )
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$l_edited_by = '<br /><br />' . sprintf($l_edit_time_total, $poster, create_date($board_config['default_dateformat'], $postrow[$i]['post_edit_time'], $board_config['board_timezone']), $postrow[$i]['post_edit_count']);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$l_edited_by = '<br />' . sprintf($l_edit_time_total, $poster, $user->date($postrow[$i]['post_edit_time']), $postrow[$i]['post_edit_count']);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//		'U_POST_ID' => $postrow[$i]['post_id'])
//	);
// }
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
		'U_POST_ID' => $postrow[$i]['post_id'])
	);
}
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
	$template->set_switch('postrow.unmark_read', $cookie_setup['keep_unreads']);

	// message icon
	$icons->topic_title('postrow', $postrow[$i]['post_icon'], ($forum_topic_data['topic_first_post_id'] == $postrow[$i]['post_id']) ? (($forum_topic_data['topic_type'] > POST_NORMAL) ? $forum_topic_data['topic_type'] : ($forum_topic_data['topic_calendar_time'] ? POST_CALENDAR : '')) : '');

	// sub title
	$front_sub_title = new front_sub_title();
	$front_sub_title->topic_title('postrow', $postrow[$i]['post_sub_title'], intval($config->data['sub_title_length']), $highlight_match);
	unset($front_sub_title);

	// first post of the topic, get additional information for the subject
	if ( $forum_topic_data['topic_first_post_id'] == $postrow[$i]['post_id'] )
	{
		// announce
		$front_announce = new front_announce();
		$front_announce->topic_title('postrow', $forum_topic_data['topic_time'], $forum_topic_data['topic_duration']);
		unset($front_announce);

		// calendar
		$front_calendar = new front_calendar();
		$front_calendar->topic_title('postrow', $forum_topic_data['topic_calendar_time'], $forum_topic_data['topic_calendar_duration']);
		unset($front_calendar);
	}
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$template->set_switch('postrow.light', !($i % 2));
	$template->set_switch('postrow.unmark_read', $cookie_setup['keep_unreads']);

	// enhance the topic title
	$front_title->set('postrow', array_merge($forum_topic_data, $postrow[$i]), $forum_topic_data['topic_first_post_id'] == $postrow[$i]['post_id'], $highlight_match);

	// post buttons switches
	$post_buttons = array('profile', 'pm', 'email', 'www', 'icq', 'aim', 'msn', 'yim', 'quote', 'search', 'edit', 'ip', 'delpost');
	$count_post_buttons = count($post_buttons);
	for ( $j = 0; $j < $count_post_buttons; $j++ )
	{
		$button = $post_buttons[$j] . '_img';
		$template->set_switch('postrow.' . $button, !empty($$button));
	}
#
#-----[ FIND ]------------------------------------------------
#
$template->assign_vars(array(
	'U_WATCH_TOPIC' => $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, $watch_mode => 'topic', 'start' => $start, 'postdays' => $post_days, 'postorder' => $post_order, 'highlight' => $highlight), true),
	'L_WATCH_TOPIC' => $user->lang($l_watch_mode),
	'I_WATCH_TOPIC' => $user->img($watch_img),
	)
);
#
#-----[ REPLACE WITH ]----------------------------------------
#
$template->assign_vars(array(
	'U_WATCH_TOPIC' => $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, $watch_mode => 'topic', 'start' => $start, 'postdays' => $post_days, 'postorder' => $post_order, 'highlight' => $highlight), true),
	'L_WATCH_TOPIC' => $user->lang($l_watch_mode),
	'I_WATCH_TOPIC' => $user->img($watch_img),

	'U_UNREAD_TOPIC' => $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, 'unmark' => 'topic'), true),
	'L_UNREAD_TOPIC' => $user->lang('Topic_unmark_read'),
	'I_UNREAD_TOPIC' => $user->img('topic_unmark_read'),

	'L_UNREAD_POST' => $user->lang('Post_unmark_read'),
	'I_UNREAD' => $user->img('icon_unmark_read'),

	'I_VIEW_PREVIOUS_TOPIC' => $user->img('topic_previous'),
	'I_VIEW_NEXT_TOPIC' => $user->img('topic_next'),

	'I_BACK_TO_TOP' => $user->img('icon_go_top'),
));
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_board.php
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'includes/functions_selects.'.$phpEx);
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// pic buttons
_button('submit');
$template->assign_vars(array(
	'I_SUBMIT' => $user->img('cmd_submit'),
	'S_SUBMIT' => $user->lang('cmd_submit'),
));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_groups.php
#
#-----[ FIND ]------------------------------------------------
#
		$group_status = intval($group_row['group_status']);
		$group_row['group_name'] = ($group_status >= GROUP_SYSTEM) ? $user->lang($group_row['group_name']) : $group_row['group_name'];
		$group_row['group_description'] = ($group_status >= GROUP_SYSTEM) ? $user->lang($group_row['group_description']) : $group_row['group_description'];
#
#-----[ REPLACE WITH ]----------------------------------------
#
		$group_status = intval($group_row['group_status']);
#
#-----[ FIND ]------------------------------------------------
#
			message_die(GENERAL_MESSAGE, $lang['Group_not_exist']);
		}

*/
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
			message_die(GENERAL_MESSAGE, $lang['Group_not_exist']);
		}
*/
//-- add
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_ranks.php
#
#-----[ FIND ]------------------------------------------------
#
				"SPECIAL_RANK" => ( $special_rank == 1 ) ? $lang['Yes'] : $lang['No'],

				"U_RANK_EDIT" => append_sid("admin_ranks.$phpEx?mode=edit&amp;id=$rank_id"),
				"U_RANK_DELETE" => append_sid("admin_ranks.$phpEx?mode=delete&amp;id=$rank_id"))
			);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->set_switch('ranks.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			"RANK_MIN" => $rank_min,

			"U_RANK_EDIT" => append_sid("admin_ranks.$phpEx?mode=edit&amp;id=$rank_id"),
			"U_RANK_DELETE" => append_sid("admin_ranks.$phpEx?mode=delete&amp;id=$rank_id"))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('ranks.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_smilies.php
#
#-----[ FIND ]------------------------------------------------
#
			"U_SMILEY_EDIT" => append_sid("admin_smilies.$phpEx?mode=edit&amp;id=" . $smilies[$i]['smilies_id']), 
			"U_SMILEY_DELETE" => append_sid("admin_smilies.$phpEx?mode=delete&amp;id=" . $smilies[$i]['smilies_id']))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('smiles.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_styles.php
#
#-----[ FIND ]------------------------------------------------
#
							for($i = 0; $i < count($$sub_dir); $i++)
							{
								$working_data = $$sub_dir;
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
								if ( !empty($working_data) && is_array($working_data) )
								{
									foreach ( $working_data as $style_id => $style_data )
									{
										$working_data[$style_id]['install_to'] = $sub_dir;
									}
								}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
						"U_STYLES_INSTALL" => append_sid("admin_styles.$phpEx?mode=addnew&amp;style=" . urlencode($installable_themes[$i]['style_name']) . "&amp;install_to=" . urlencode($installable_themes[$i]['template_name'])))
					);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
						'U_STYLES_INSTALL' => $config->url('admin/admin_styles', array('mode' => 'addnew', 'style' => urlencode($installable_themes[$i]['style_name']), 'install_to' => urlencode($installable_themes[$i]['install_to'])), true),
					));
					$template->set_switch('styles.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				"U_STYLES_EDIT" => append_sid("admin_styles.$phpEx?mode=edit&amp;style_id=" . $style_rowset[$i]['themes_id']),
				"U_STYLES_DELETE" => append_sid("admin_styles.$phpEx?mode=delete&amp;style_id=" . $style_rowset[$i]['themes_id']))
			);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->set_switch('styles.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_users.php
#
#-----[ FIND ]------------------------------------------------
#
	$module['Users']['Manage'] = $filename;

	return;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
define('IN_PROFILE', true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$user_style = ( $HTTP_POST_VARS['style'] ) ? intval( $HTTP_POST_VARS['style'] ) : $board_config['default_style'];
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$user_style = _read('style', TYPE_INT, $config->data['default_style']);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_words.php
#
#-----[ FIND ]------------------------------------------------
#
			"U_WORD_EDIT" => append_sid("admin_words.$phpEx?mode=edit&amp;id=$word_id"),
			"U_WORD_DELETE" => append_sid("admin_words.$phpEx?mode=delete&amp;id=$word_id"))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('words.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/index.php
#
#-----[ FIND ]------------------------------------------------
#
	$setmodules = 1;
	while( $file = @readdir($dir) )
	{
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		if ( in_array(str_replace('.' . $phpEx, '', $file), $denied_scripts) )
		{
			$file = '';
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					"U_USER_PROFILE" => append_sid("admin_users.$phpEx?mode=edit&amp;" . POST_USERS_URL . "=" . $onlinerow_reg[$i]['user_id']),
					"U_FORUM_LOCATION" => append_sid($location_url))
				);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$template->set_switch('reg_user_row.light', $registered_users % 2);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				"U_WHOIS_IP" => "http://network-tools.com/default.asp?host=$guest_ip", 
				"U_FORUM_LOCATION" => append_sid($location_url))
			);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->set_switch('guest_user_row.light', $guest_users % 2);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$current_version = explode('.', '2' . $board_config['version']);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	$version_info .= '<p>' . $lang['Mailing_list_subscribe_reminder'] . '</p>';
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	// installed mods
	$mod_installed = array(
		'phpBB group' => array(
			'server' => 'www.phpbb.com',
			'root' => '/updatecheck/',
			'file' => '20x.txt',
			'page' => 'http://www.phpbb.com/downloads.php',
			'protocol' => 'phpBB',
			'infos' => 'Mailing_list_subscribe_reminder',
			'mods' => array(
				'version' => array('head' => '2', 'desc' => 'phpBB'),
			),
		),
		'Ptirhiik' => array(
			'server' => 'ptifo.clanmckeen.com',
			'root' => '/download/',
			'file' => 'versions.dta',
			'page' => 'http://ptifo.clanmckeen.com/download.php',
			'protocol' => 'native',
			'mods' => array(
				'mod_cat_hierarchy' => array('desc' => 'Lang_extend_cat_hierarchy'),
				'mod_topic_calendar_CH' => array('desc' => 'Lang_extend_calendar'),
				'mod_extended_tpl_CH' => array('desc' => 'Extended_template_CH'),
			),
		),
	);

	// we don't want to check at any time : do it only once a day
	define('VERSION_CHECK_DELAY', 86400);
	$now = time();
	$version_check_delay = intval($config->data['version_check_delay']);
	$check = _button('vchk') || empty($version_check_delay) || (($now - $version_check_delay) > VERSION_CHECK_DELAY);

	// try to open the files
	$mod_available = array();
	$version_info = '';
	foreach ( $mod_installed as $provider => $provided )
	{
		if ( $check )
		{
			$config->set('version_check_delay', $now, true);
			$mod_installed[$provider]['errno'] = 0;
			$mod_installed[$provider]['errstr'] = '';
			if ( $fsock = @fsockopen($provided['server'], 80, $mod_installed[$provider]['errno'], $mod_installed[$provider]['errstr']) )
			{
				@fputs($fsock, "GET " . $provided['root'] . $provided['file'] . " HTTP/1.1\r\n");
				@fputs($fsock, "HOST: " . $provided['server'] . "\r\n");
				@fputs($fsock, "Connection: close\r\n\r\n");

				$get_info = false;
				$available = '';
				while ( !@feof($fsock) )
				{
					if ( $get_info )
					{
						$available .= @fread($fsock, 1024);
					}
					else
					{
						if ( @fgets($fsock, 1024) == "\r\n" )
						{
							$get_info = true;
						}
					}
				}
				@fclose($fsock);

				$available = empty($available) ? array() : explode("\n", $available);
				$count_available = count($available);
				switch ( $provided['protocol'] )
				{
					case 'native':
						for ( $i = 0; $i < $count_available; $i++ )
						{
							$str = trim(str_replace(array("\r", "\n"), array('', ''), $available[$i]));
							$line = empty($str) ? array() : explode(':', $str);
							$mod_name = trim($line[0]);
							$mod_version = trim($line[1]);
							if ( !empty($mod_name) && !empty($mod_version) && isset($mod_installed[$provider]['mods'][$mod_name]) )
							{
								$mod_installed[$provider]['mods'][$mod_name]['version'] = $mod_version;
							}
						}
						break;
					case 'phpBB':
						for ( $i = 0; $i < $count_available; $i++ )
						{
							$str = trim(str_replace("\r", '', $available[$i]));
							$available[$i] = (int) $str;
						}
						$mod_name = _first_key($mod_installed[$provider]['mods']);
						$mod_version = implode('.', $available);
						if ( !empty($mod_name) && !empty($mod_version) && isset($mod_installed[$provider]['mods'][$mod_name]) )
						{
							$mod_installed[$provider]['mods'][$mod_name]['version'] = $mod_version;
						}
						break;
				}
			}
		}

		// display actualized data
		$u_provider = empty($mod_installed[$provider]['page']) ? $provider : '<a href="' . $mod_installed[$provider]['page'] . '" target="_blank">' . $provider . '</a>';
		if ( $mod_installed[$provider]['errno'] )
		{
			if ( $mod_installed[$provider]['errstr'] )
			{
				$version_info .= '<p style="color:red">' . $u_provider . ': ' . sprintf($user->lang('Connect_socket_error'), $mod_installed[$provider]['errstr']) . '<br />';
			}
			else
			{
				$version_info .= '<p>' . $u_provider . ': ' . $user->lang('Socket_functions_disabled') . '<br />';
			}
		}
		else
		{
			$version_info .= '<p style="color:blue"><b><u>' . $u_provider . '</u></b><br />';
		}

		// dump the mods
		if ( !empty($mod_installed[$provider]['mods']) )
		{
			foreach ( $mod_installed[$provider]['mods'] as $mod_name => $mod_data )
			{
				if ( isset($config->data[$mod_name]) )
				{
					$current_version = $mod_installed[$provider]['mods'][$mod_name]['head'] . $config->data[$mod_name];
					if ( isset($mod_installed[$provider]['mods'][$mod_name]['version']) )
					{
						$color = '<span style="color:' . (isset($config->data[$mod_name]) ? ($mod_installed[$provider]['mods'][$mod_name]['version'] == $current_version ? 'green' : 'red') : 'brown') . '">%s</span>';
					}
					else
					{
						$color = '%s';
					}
					$version_info .= sprintf($color, sprintf($user->lang(isset($mod_installed[$provider]['mods'][$mod_name]['version']) ? 'version_checked' : 'version_not_checked'), $user->lang($mod_installed[$provider]['mods'][$mod_name]['desc']), isset($config->data[$mod_name]) ? $current_version : $user->lang('Unknown'), $mod_installed[$provider]['mods'][$mod_name]['version'])) . '<br />';
				}
			}
		}
		$version_info .= '</p>';
		if ( !empty($mod_installed[$provider]['infos']) )
		{
			$version_info .= '<p>' . $user->lang($mod_installed[$provider]['infos']) . '</p>';
		}
	}
	$version_info = '<a href="' . $config->url('admin/index', array('pane' => 'right', 'vchk' => true), true) . '" class="gen"><img src="' . $user->img('cmd_check') . '" border="0" class="absbottom" /></a><br /><br />' . $version_info;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/page_footer_admin.php
#
#-----[ FIND ]------------------------------------------------
#
);

$template->pparse('page_footer');

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// send run stat (page generation, sql time, requests dump...)
$stat_run = new stat_run_class(microtime());
if ( (_read('pane') != 'left') && defined('DEBUG') && defined('DEBUG_SQL_ADMIN') )
{
	$stat_run->display();
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
);
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( (_read('pane') != 'left') && defined('DEBUG') && defined('DEBUG_SQL_ADMIN') )
{
	// send run stat (page generation, sql time, requests dump...)
	include($config->url('includes/class_run_stats'));
	$stat_run = new stat_run_class(microtime());
	$stat_run->display();
}
//-- fin mod : categories hierarchy --------------------------------------------

$template->pparse('page_footer');
#
#-----[ OPEN ]------------------------------------------------
#
admin/page_header_admin.php
#
#-----[ FIND ]------------------------------------------------
#
);


//-- mod : categories hierarchy ------------------------------------------------
$template->assign_vars(array(
	'I_SPACER' => $user->img('spacer'),
));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
);

//-- mod : categories hierarchy ------------------------------------------------
$template->assign_vars(array(
	'I_SPACER' => $user->img('spacer'),
	'I_LOGO_SMALL' => $user->img('logo_small'),
));

// set the in_admin switch
$template->set_switch('in_admin', defined('IN_ADMIN'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/pagestart.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	redirect("index.$phpEx?sid=" . $userdata['session_id']);
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// check if .htaccess is available
if ( ($userdata['session_admin'] == true) || @file_exists('.htaccess') )
{
	$userdata['session_admin'] = true;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/auth.php
#
#-----[ FIND ]------------------------------------------------
#
	return $auth_user;
}
*/
//-- fin mod : categories hierarchy --------------------------------------------

function auth_check_user($type, $key, $u_access, $is_admin)
#
#-----[ REPLACE WITH ]----------------------------------------
#
	return $auth_user;
}

function auth_check_user($type, $key, $u_access, $is_admin)
#
#-----[ FIND ]------------------------------------------------
#
	return $auth_user;
}

?>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	return $auth_user;
}
*/
//-- fin mod : categories hierarchy --------------------------------------------

?>
#
#-----[ OPEN ]------------------------------------------------
#
includes/bbcode.php
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//		global $db, $board_config;
//		$orig = $repl = array();
//
//		$sql = 'SELECT * FROM ' . SMILIES_TABLE;
//		if( !$result = $db->sql_query($sql) )
//		{
//			message_die(GENERAL_ERROR, "Couldn't obtain smilies data", "", __LINE__, __FILE__, $sql);
//		}
//		$smilies = $db->sql_fetchrowset($result);
//		if (count($smilies))
//		{
//			usort($smilies, 'smiley_sort');
//		}
//
//		for ($i = 0; $i < count($smilies); $i++)
//		{
//			$orig[] = "/(?<=.\W|\W.|^\W)" . phpbb_preg_quote($smilies[$i]['code'], "/") . "(?=.\W|\W.|\W$)/";
//			$repl[] = '<img src="'. $board_config['smilies_path'] . '/' . $smilies[$i]['smile_url'] . '" alt="' . $smilies[$i]['emoticon'] . '" border="0" />';
//		}
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
		global $db, $board_config;
		$orig = $repl = array();

		$sql = 'SELECT * FROM ' . SMILIES_TABLE;
		if( !$result = $db->sql_query($sql) )
		{
			message_die(GENERAL_ERROR, "Couldn't obtain smilies data", "", __LINE__, __FILE__, $sql);
		}
		$smilies = $db->sql_fetchrowset($result);

		if (count($smilies))
		{
			usort($smilies, 'smiley_sort');
		}

		for ($i = 0; $i < count($smilies); $i++)
		{
			$orig[] = "/(?<=.\W|\W.|^\W)" . phpbb_preg_quote($smilies[$i]['code'], "/") . "(?=.\W|\W.|\W$)/";
			$repl[] = '<img src="'. $board_config['smilies_path'] . '/' . $smilies[$i]['smile_url'] . '" alt="' . $smilies[$i]['emoticon'] . '" border="0" />';
		}
*/
//-- add
#
#-----[ OPEN ]------------------------------------------------
#
includes/db.php
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// $db = new sql_db($dbhost, $dbuser, $dbpasswd, $dbname, false);
//-- add
include_once($phpbb_root_path . 'includes/class_db.' . $phpEx);
$db = new db_class($dbhost, $dbuser, $dbpasswd, $dbname, false);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
$db = new sql_db($dbhost, $dbuser, $dbpasswd, $dbname, false);
*/
//-- add
include_once($phpbb_root_path . 'includes/class_db.' . $phpEx);
$db = new db_class($dbhost, $dbuser, $dbpasswd, $dbname, false);
unset($dbhost);
unset($dbuser);
unset($dbpasswd);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions.php
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
/*

//	$is_auth = auth(AUTH_VIEW, AUTH_LIST_ALL, $userdata);
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
//	$is_auth = auth(AUTH_VIEW, AUTH_LIST_ALL, $userdata);
#
#-----[ FIND ]------------------------------------------------
#
*/
//-- add
	global $config, $forums;

	if ( substr($action, 0, strlen('viewforum')) == 'viewforum' )
	{
		$action = 'index';
	}
	else if ( substr($action, 0, strlen('modcp')) == 'modcp' )
	{
		$action = 'modcp';
	}
	$action = $config->url($action);
	if ( empty($forums) )
	{
		include_once($config->url('includes/class_forums'));
		$forums = new forums();
		$forums->read();
	}
	$boxstring = '<select name="' . POST_FORUM_URL . '" onchange="if(this.options[this.selectedIndex].value >= 0){ forms[\'jumpbox\'].submit() }"><option value="-2" selected="selected">' . $lang['Select_forum'] . '</option><option value="-1">-------------------</option>';
	$boxstring .= $forums->get_jumpbox();
	$boxstring .= '</select><input type="hidden" name="sid" value="' . $userdata['session_id'] . '" />';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
*/
//-- add
	global $config, $forums, $user;

	if ( eregi('^viewforum', $action) )
	{
		$action = 'index';
	}
	else if ( eregi('^modcp', $action) )
	{
		$action = 'modcp';
	}
	$action = $config->url($action, '', true);
	if ( empty($forums) )
	{
		include_once($config->url('includes/class_forums'));
		$forums = new forums();
		$forums->read();
	}
	$boxstring = '<select name="' . POST_FORUM_URL . '" onchange="if(this.options[this.selectedIndex].value >= 0){ forms[\'jumpbox\'].submit() }"><option value="-2" selected="selected">' . $lang['Select_forum'] . '</option><option value="-1">-------------------</option>';
	$boxstring .= $forums->get_jumpbox();
	$boxstring .= '</select><input type="hidden" name="sid" value="' . $userdata['session_id'] . '" />';
	$template->assign_vars(array(
		'I_GO' => $user->img('cmd_mini_submit'),
	));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//	if ( !$board_config['override_user_style'] )
//	{
//		if ( $userdata['user_id'] != ANONYMOUS && $userdata['user_style'] > 0 )
//		{
//			if ( $theme = setup_style($userdata['user_style']) )
//			{
//				return;
//			}
//		}
//	}
//
//	$theme = setup_style($board_config['default_style']);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
	if ( !$board_config['override_user_style'] )
	{
		if ( $userdata['user_id'] != ANONYMOUS && $userdata['user_style'] > 0 )
		{
			if ( $theme = setup_style($userdata['user_style']) )
			{
				return;
			}
		}
	}

	$theme = setup_style($board_config['default_style']);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*

	$sql = "SELECT *
		FROM " . THEMES_TABLE . "
		WHERE themes_id = $style";
#
#-----[ REPLACE WITH ]----------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
	$sql = "SELECT *
		FROM " . THEMES_TABLE . "
		WHERE themes_id = $style";
#
#-----[ FIND ]------------------------------------------------
#
*/
//-- add
	global $config, $themes;
#
#-----[ REPLACE WITH ]----------------------------------------
#
*/
//-- add
	global $config, $user, $themes;
#
#-----[ FIND ]------------------------------------------------
#
				$images += $sav_images;
			}
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#

		// .ini file
		@include($phpbb_root_path . $template_path . $template_name . '/' . $template_name . '.ini');
#
#-----[ FIND ]------------------------------------------------
#
	global $board_config, $lang;
	static $translate;

	if ( empty($translate) && $board_config['default_lang'] != 'english' )
	{
		@reset($lang['datetime']);
		while ( list($match, $replace) = @each($lang['datetime']) )
		{
			$translate[$match] = $replace;
		}
	}

	return ( !empty($translate) ) ? strtr(@gmdate($format, $gmepoch + (3600 * $tz)), $translate) : @gmdate($format, $gmepoch + (3600 * $tz));
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	global $user;
	return $user->date($gmepoch, $format);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : Fix message_die for multiple errors ---------------------------------
// note : this one is Markus Petrux's "Fix message_die for multiple errors" mod
//-- delete
//	if(defined('HAS_DIED'))
//	{
//		die("message_die() was called multiple times. This isn't supposed to happen. Was message_die() used in page_tail.php?");
//	}
//	
//	define('HAS_DIED', 1);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : Fix message_die for multiple errors ---------------------------------
// note : this one is Markus Petrux's "Fix message_die for multiple errors" mod
//-- delete
/*
	if(defined('HAS_DIED'))
	{
		die("message_die() was called multiple times. This isn't supposed to happen. Was message_die() used in page_tail.php?");
	}
	
	define('HAS_DIED', 1);
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//			$template = new Template($phpbb_root_path . 'templates/' . $board_config['board_template']);
//-- add
			$template = new template_class($phpbb_root_path . 'templates/' . $board_config['board_template']);
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
			$template = new Template($phpbb_root_path . 'templates/' . $board_config['board_template']);
*/
//-- add
			$template = new template_class($phpbb_root_path . 'templates/' . $board_config['board_template']);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		if ( defined('DEBUG_MESSAGES') && !defined('IN_MESSAGE_RETURN') )
		{
			if ( empty($lang) )
			{
				$lang = array(
					'dbg_backtrace' => 'Back trace',
					'dbg_requester' => 'Requester',
				);
			}
			$msg_text .= '<br /><br /></span></td></tr><tr><td class="cat" align="center"><span class="cattitle">' . $lang['dbg_backtrace'] . '</span></td></tr><tr><td class="row1"><span class="gen">';
			if ( function_exists('debug_backtrace') )
			{
				$dbg = debug_backtrace();
				$count_dbg = count($dbg);
				$tmp = new cache(); // this one is to access format arrays function
				for ( $i = 0; $i < $count_dbg; $i++ )
				{
					$msg_text .= '<br /><b>' . $lang['dbg_requester'] . ':</b> ' . basename($dbg[$i]['file']) . '[ ' . $dbg[$i]['line'] . ' ].' . $dbg[$i]['function'] . '(' . (empty($dbg[$i]['args']) ? '' : stripslashes($tmp->format_array($dbg[$i]['args'], false, false))) . ')';
				}
			}
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		if ( defined('DEBUG_MESSAGES') && !defined('IN_MESSAGE_RETURN') )
		{
			if ( empty($lang) )
			{
				$lang = array(
					'dbg_backtrace' => 'Back trace',
					'dbg_requester' => 'Requester',
				);
			}
			$msg_text .= '<br /><br /></span></td></tr><tr><td class="cat" align="center"><span class="cattitle">' . $lang['dbg_backtrace'] . '</span></td></tr><tr><td class="row1"><span class="gen">';
			if ( function_exists('debug_backtrace') )
			{
				$dbg = debug_backtrace();
				$count_dbg = count($dbg);
				for ( $i = 0; $i < $count_dbg; $i++ )
				{
					$msg_text .= '<br /><b>' . $lang['dbg_requester'] . ':</b> ' . basename($dbg[$i]['file']) . '[ ' . $dbg[$i]['line'] . ' ].' . $dbg[$i]['function'] . '(' . (empty($dbg[$i]['args']) ? '' : stripslashes(_format($dbg[$i]['args']))) . ')';
				}
			}
		}
		if ( !defined('IN_ADMIN') && !empty($config->data) )
		{
			global $navigation;

			if ( !isset($navigation) || !is_object($navigation) )
			{
				$navigation = new navigation();
			}
			if ( !$navigation->displayed )
			{
				$navigation->display();
			}
		}
		else
		{
			$template->assign_vars(array(
				'NAVIGATION_BOX' => '<a href="' . append_sid('index.' . $phpEx) . '" class="nav">' . sprintf($lang['Forum_Index'], $board_config['sitename']) . '</a>',
			));
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$url = preg_replace('#^\/?(.*?)\/?$#', '/\1', trim($url));
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	}
	else
	{
		$server_protocol = $server_name = $server_port = $script_name = '';
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
	$url = preg_replace('#^\/?(.*?)\/?$#', '/\1', trim($url));
*/
//-- add
		$url = preg_replace('#^\/?(.*?)\/?$#', '/\1', trim(preg_replace('#^(\.\/)(.*)$#', '\2', $url)));
	}
	else
	{
		$server_protocol = $server_name = $server_port = $script_name = '';
	}
	$url_ampersand = $url;
	$url = str_replace('&amp;', '&', $url);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		echo '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><meta http-equiv="refresh" content="0; url=' . $server_protocol . $server_name . $server_port . $script_name . $url . '"><title>Redirect</title></head><body><div align="center">If your browser does not support meta redirection please click <a href="' . $server_protocol . $server_name . $server_port . $script_name . $url . '">HERE</a> to be redirected</div></body></html>';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
// here we replaced : 
//	$url . '">HERE
// with
//	$url_ampersand . '">HERE
//-- modified
#
#----------[ IN-LINE FIND ]-----------------------------------
#
$url . '">HERE
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
$url_ampersand . '">HERE
#
#-----[ AFTER, ADD ]------------------------------------------
#
# on a new line
#
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_post.php
#
#-----[ FIND ]------------------------------------------------
#
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
// here we added
//	, $post_icon=0, $topic_duration=0, $calendar_time=0, $calendar_duration=0, $sub_title='', $topic_sub_type=0
//-- modify
function submit_post($mode, &$post_data, &$message, &$meta, &$forum_id, &$topic_id, &$post_id, &$poll_id, &$topic_type, &$bbcode_on, &$html_on, &$smilies_on, &$attach_sig, &$bbcode_uid, &$post_username, &$post_subject, &$post_message, &$poll_title, &$poll_options, &$poll_length, $post_icon=0, $topic_duration=0, $calendar_time=0, $calendar_duration=0, $sub_title='', $topic_sub_type=0)
//-- fin mod : categories hierarchy --------------------------------------------
{
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
function submit_post($mode, &$post_data, &$message, &$meta, &$forum_id, &$topic_id, &$post_id, &$poll_id, &$topic_type, &$bbcode_on, &$html_on, &$smilies_on, &$attach_sig, &$bbcode_uid, &$post_username, &$post_subject, &$post_message, &$poll_title, &$poll_options, &$poll_length)
{
*/
//-- add
function submit_post($mode, &$post_data, &$message, &$meta, &$forum_id, &$topic_id, &$post_id, &$poll_id, &$input_data)
{
	$awaited_input_data = array(
		'topic_type' => 0,
		'bbcode_on' => 0,
		'html_on' => 0,
		'smilies_on' => 0,
		'attach_sig' => 0,
		'bbcode_uid' => '',
		'post_username' => '',
		'post_subject' => '',
		'post_message' => '',
		'poll_title' => '',
		'poll_options' => array(),
		'poll_length' => 0,
		'post_icon' => 0,
		'topic_duration' => 0,
		'calendar_time' => 0,
		'calendar_duration' => 0,
		'sub_title' => '',
		'topic_sub_type' => 0,
	);
	foreach ( $awaited_input_data as $var => $dft )
	{
		$$var = isset($input_data[$var]) ? $input_data[$var] : $dft;
	}

	// reclaim some memory
	$input_data = array();
	unset($awaited_input_data);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$topic_fields = array();
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config;

	$topic_fields = array();
#
#-----[ FIND ]------------------------------------------------
#
				'topic_icon' => $post_icon,
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
				'topic_sub_type' => $topic_sub_type,
#
#-----[ FIND ]------------------------------------------------
#
			if ( defined('POST_CALENDAR') )
#
#-----[ REPLACE WITH ]----------------------------------------
#
			if ( $config->data['mod_topic_calendar_CH'] )
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//	$message = $lang['Stored'] . '<br /><br />' . sprintf($lang['Click_view_message'], '<a href="' . append_sid("viewtopic.$phpEx?" . POST_POST_URL . "=" . $post_id) . '#' . $post_id . '">', '</a>') . '<br /><br />' . sprintf($lang['Click_return_forum'], '<a href="' . append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id") . '">', '</a>');
//-- add
	global $config;
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
	$message = $lang['Stored'] . '<br /><br />' . sprintf($lang['Click_view_message'], '<a href="' . append_sid("viewtopic.$phpEx?" . POST_POST_URL . "=" . $post_id) . '#' . $post_id . '">', '</a>') . '<br /><br />' . sprintf($lang['Click_return_forum'], '<a href="' . append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id") . '">', '</a>');
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//				$sql = "SELECT MAX(post_id) AS last_post_id
//					FROM " . POSTS_TABLE . " 
//					WHERE topic_id = $topic_id";
//				if (!($result = $db->sql_query($sql)))
//				{
//					message_die(GENERAL_ERROR, 'Error in deleting post', '', __LINE__, __FILE__, $sql);
//				}
//
//				if ($row = $db->sql_fetchrow($result))
//				{
//					$topic_update_sql .= ', topic_last_post_id = ' . $row['last_post_id'];
//				}
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
				$sql = "SELECT MAX(post_id) AS last_post_id
					FROM " . POSTS_TABLE . " 
					WHERE topic_id = $topic_id";
				if (!($result = $db->sql_query($sql)))
				{
					message_die(GENERAL_ERROR, 'Error in deleting post', '', __LINE__, __FILE__, $sql);
				}

				if ($row = $db->sql_fetchrow($result))
				{
					$topic_update_sql .= ', topic_last_post_id = ' . $row['last_post_id'];
				}
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//				$sql = "SELECT MAX(post_id) AS last_post_id
//					FROM " . POSTS_TABLE . " 
//					WHERE forum_id = $forum_id"; 
//				if (!($result = $db->sql_query($sql)))
//				{
//					message_die(GENERAL_ERROR, 'Error in deleting post', '', __LINE__, __FILE__, $sql);
//				}
//
//				if ($row = $db->sql_fetchrow($result))
//				{
//					$forum_update_sql .= ($row['last_post_id']) ? ', forum_last_post_id = ' . $row['last_post_id'] : ', forum_last_post_id = 0';
//				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
				$sql = "SELECT MAX(post_id) AS last_post_id
					FROM " . POSTS_TABLE . " 
					WHERE forum_id = $forum_id"; 
				if (!($result = $db->sql_query($sql)))
				{
					message_die(GENERAL_ERROR, 'Error in deleting post', '', __LINE__, __FILE__, $sql);
				}

				if ($row = $db->sql_fetchrow($result))
				{
					$forum_update_sql .= ($row['last_post_id']) ? ', forum_last_post_id = ' . $row['last_post_id'] : ', forum_last_post_id = 0';
				}
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//	$sql = "UPDATE " . FORUMS_TABLE . " SET 
//		$forum_update_sql 
//		WHERE forum_id = $forum_id";
//	if (!$db->sql_query($sql))
//	{
//		message_die(GENERAL_ERROR, 'Error in posting', '', __LINE__, __FILE__, $sql);
//	}
//-- fin mod : categories hierarchy ---------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
	$sql = "UPDATE " . FORUMS_TABLE . " SET 
		$forum_update_sql 
		WHERE forum_id = $forum_id";
	if (!$db->sql_query($sql))
	{
		message_die(GENERAL_ERROR, 'Error in posting', '', __LINE__, __FILE__, $sql);
	}
*/
//-- fin mod : categories hierarchy ---------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//		$meta = '<meta http-equiv="refresh" content="3;url=' . append_sid("viewforum.$phpEx?" . POST_FORUM_URL . '=' . $forum_id) . '">';
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
		$meta = '<meta http-equiv="refresh" content="3;url=' . append_sid("viewforum.$phpEx?" . POST_FORUM_URL . '=' . $forum_id) . '">';
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//	$message .=  '<br /><br />' . sprintf($lang['Click_return_forum'], '<a href="' . append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id") . '">', '</a>');
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
	$message .=  '<br /><br />' . sprintf($lang['Click_return_forum'], '<a href="' . append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id") . '">', '</a>');
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//	$sql = "SELECT emoticon, code, smile_url   
//		FROM " . SMILIES_TABLE . " 
//		ORDER BY smilies_id";
//	if ($result = $db->sql_query($sql))
//	{
//		$num_smilies = 0;
//		$rowset = array();
//		while ($row = $db->sql_fetchrow($result))
//		{
//			if (empty($rowset[$row['smile_url']]))
//			{
//				$rowset[$row['smile_url']]['code'] = str_replace("'", "\\'", str_replace('\\', '\\\\', $row['code']));
//				$rowset[$row['smile_url']]['emoticon'] = $row['emoticon'];
//				$num_smilies++;
//			}
//		}
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
	$sql = "SELECT emoticon, code, smile_url   
		FROM " . SMILIES_TABLE . " 
		ORDER BY smilies_id";
	if ($result = $db->sql_query($sql))
	{
		$num_smilies = 0;
		$rowset = array();
		while ($row = $db->sql_fetchrow($result))
		{
			if (empty($rowset[$row['smile_url']]))
			{
				$rowset[$row['smile_url']]['code'] = str_replace("'", "\\'", str_replace('\\', '\\\\', $row['code']));
				$rowset[$row['smile_url']]['emoticon'] = $row['emoticon'];
				$num_smilies++;
			}
		}
*/
//-- add
#
#-----[ FIND ]------------------------------------------------
#
//-- delete
//					'U_MORE_SMILIES' => append_sid("posting.$phpEx?mode=smilies"))
//				);
//-- add
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- delete
/*
					'U_MORE_SMILIES' => append_sid("posting.$phpEx?mode=smilies"))
				);
*/
//-- add
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_search.php
#
#-----[ FIND ]------------------------------------------------
#
function clean_words($mode, &$entry, &$stopword_list, &$synonym_list)
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
function clean_words($mode, &$entry, &$stopword_list, &$synonym_list)
*/
//-- add
function clean_words($mode, $entry, &$stopword_list, &$synonym_list)
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function split_words(&$entry, $mode = 'post')
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
function split_words(&$entry, $mode = 'post')
*/
//-- add
function split_words($entry, $mode = 'post')
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_selects.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$style_select = '<select name="' . $select_name . '">';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	if ( !defined('IN_ADMIN') || defined('IN_PROFILE') )
	{
		global $user;
		$selected = empty($default_style) ? ' selected="selected"' : '';
		$style_select .= '<option value="0"' . $selected . '>' . $user->lang('Default') . '</option>';
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/page_header.php
#
#-----[ FIND ]------------------------------------------------
#
$nav_link_proto = '<link rel="%s" href="%s" title="%s" />' . "\n";
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$nav_link_proto = '<link rel="%s" href="%s" title="%s">' . "\n";
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( !empty($config->data['site_fav_icon']) )
{
	$nav_links_html .= '<link rel="SHORTCUT ICON" href="' . $user->img($config->data['site_fav_icon']) . '">';
}
$nav_links_html .= "\n" . '<link rel="copyright" href="http://phpBB.com" title="phpBB.com" />';
$template->assign_vars(array(
	'L_PREFERENCES' => $lang['Preferences'],
	'U_PREFERENCES' => $config->url('usercp', '', true),
	'I_SPACER' => $user->img('spacer'),
));
//-- fin mod : categories hierarchy --------------------------------------------

// Format Timezone. We are unable to use array_pop here, because of PHP3 compatibility
$l_timezone = explode('.', $board_config['board_timezone']);
$l_timezone = (count($l_timezone) > 1 && $l_timezone[count($l_timezone)-1] != 0) ? $lang[sprintf('%.1f', $board_config['board_timezone'])] : $lang[number_format($board_config['board_timezone'])];
#
#-----[ REPLACE WITH ]----------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
// Format Timezone. We are unable to use array_pop here, because of PHP3 compatibility
$l_timezone = explode('.', $board_config['board_timezone']);
$l_timezone = (count($l_timezone) > 1 && $l_timezone[count($l_timezone)-1] != 0) ? $lang[sprintf('%.1f', $board_config['board_timezone'])] : $lang[number_format($board_config['board_timezone'])];
*/
//-- add
$l_timezone = $user->get_timezone();

if ( !empty($config->data['site_fav_icon']) )
{
	$nav_links_html .= '<link rel="SHORTCUT ICON" href="' . $user->img($config->data['site_fav_icon']) . '">';
}
$nav_links_html .= "\n" . '<link rel="copyright" href="http://phpBB.com" title="phpBB.com">';
$is_admin = $user->data['session_logged_in'] && ($user->data['user_level'] == ADMIN);
$template->assign_vars(array(
	// preferences
	'L_PREFERENCES' => $user->lang('Preferences'),
	'U_PREFERENCES' => $config->url('usercp', '', true),

	// logos
	'I_SPACER' => $user->img('spacer'),
	'I_LOGO' => $user->img('logo'),
	'I_LOGO_SMALL' => $user->img('logo_small'),

	// admin
	'U_ADMIN_LINK' => $is_admin ? $config->url('admin/index', array('sid' => $user->data['session_id']), true) : '',
	'L_ADMIN_LINK' => $is_admin ? $user->lang('Admin_panel') : '',
	'I_ADMIN_LINK' => $is_admin ? $user->img('menu_admin') : '',

	// pics for other options
	'I_ACP' => $user->img('menu_acp'),
	'I_FAQ' => $user->img('menu_faq'),
	'I_SEARCH' => $user->img('menu_search'),
	'I_MEMBERLIST' => $user->img('menu_memberlist'),
	'I_GROUP_CP' => $user->img('menu_usergroup'),
	'I_REGISTER' => $user->img('menu_register'),
	'I_PROFILE' => $user->img('menu_profile'),
	'I_PREFERENCES' => $user->img('menu_preferences'),
	'I_LOGIN' => $user->img('menu_login'),
	'I_LOGOUT' => $user->img('menu_logout'),
));
$template->set_switch('user_is_admin', $is_admin);
$template->set_switch('in_admin', defined('IN_ADMIN'));

// calendar if present
if ( !empty($config->data['mod_topic_calendar_CH']) && !defined('IN_CALENDAR') )
{
	@include_once($config->url('includes/class_calendar'));
	if ( class_exists('calendar') )
	{
		$calendar = new calendar();
		$calendar->display('CALENDAR_BOX');
		unset($calendar);
	}
	else
	{
		$sql = 'DELETE FROM ' . CONFIG_TABLE . '
			WHERE config_name = \'mod_topic_calendar_CH\'';
		$db->sql_query($sql, false, __LINE__, __FILE__);
		$config->read(true);
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'CURRENT_TIME' => sprintf($lang['Current_time'], create_date($board_config['default_dateformat'], time(), $board_config['board_timezone'])),
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	'CURRENT_TIME' => sprintf($user->lang('Current_time'), $user->date(time(), '', false)),
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/page_tail.php
#
#-----[ FIND ]------------------------------------------------
#
);

$template->pparse('overall_footer');

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// send run stat (page generation, sql time, requests dump...)
$stat_run = new stat_run_class(microtime());
if ( empty($gen_simple_header) && defined('DEBUG') )
{
	$stat_run->display();
}

// send messages
if ( defined('CH_message_queue') && empty($gen_simple_header) && !empty($message_queue->data) )
{
	$message_queue->send();
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
);
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( empty($gen_simple_header) && defined('DEBUG') )
{
	// send run stat (page generation, sql time, requests dump...)
	include($config->url('includes/class_run_stats'));
	$stat_run = new stat_run_class(microtime());
	$stat_run->display();
}
//-- fin mod : categories hierarchy --------------------------------------------

$template->pparse('overall_footer');

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// send messages
if ( defined('CH_message_queue') && empty($gen_simple_header) && !empty($message_queue->data) )
{
	$message_queue->send();
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/sessions.php
#
#-----[ FIND ]------------------------------------------------
#
//
// Adds/updates a new session to the database for the given userid.
// Returns the new session ID on success.
//
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
function session_force_guest()
{
	global $db;

	$sql = 'SELECT u.*, g.*
				FROM ' . USERS_TABLE . ' u, ' . GROUPS_TABLE . ' g
				WHERE u.user_id = ' . ANONYMOUS . '
					AND g.group_user_id = u.user_id';
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	$userdata = $db->sql_fetchrow($result);
	$db->sql_freeresult($result);
	$userdata['user_id'] = ANONYMOUS;
	return $userdata;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//	$sql = "SELECT * 
//		FROM " . USERS_TABLE . " 
//		WHERE user_id = $user_id";
//-- add
	$sql = 'SELECT u.*, g.*
				FROM ' . USERS_TABLE . ' u
					LEFT JOIN ' . GROUPS_TABLE . ' g
						ON g.group_user_id = u.user_id
				WHERE user_id = ' . intval($user_id);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
	$sql = "SELECT * 
		FROM " . USERS_TABLE . " 
		WHERE user_id = $user_id";
*/
//-- add
	$sql = 'SELECT u.*, g.*
				FROM ' . USERS_TABLE . ' u, ' . GROUPS_TABLE . ' g
				WHERE u.user_id = ' . intval($user_id) . '
					AND g.group_user_id = u.user_id';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					// No match; don't login, set as anonymous user
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
					$userdata = session_force_guest();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					$sql = 'SELECT * FROM ' . USERS_TABLE . ' WHERE user_id = ' . ANONYMOUS;
					$result = $db->sql_query($sql);
					$userdata = $db->sql_fetchrow($result);
					$db->sql_freeresult($result);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				// Autologin is not set. Don't login, set as anonymous user
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$userdata = session_force_guest();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				$sql = 'SELECT * FROM ' . USERS_TABLE . ' WHERE user_id = ' . ANONYMOUS;
				$result = $db->sql_query($sql);
				$userdata = $db->sql_fetchrow($result);
				$db->sql_freeresult($result);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if (!$admin)
		{
			$sql = "UPDATE " . USERS_TABLE . " 
				SET user_session_time = $current_time, user_session_page = $page_id, user_lastvisit = $last_visit
				WHERE user_id = $user_id";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$sql = str_replace('SET ', 'SET user_session_logged = ' . intval($login) . ', ', $sql);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//		$sql = "SELECT u.*, s.*
//			FROM " . SESSIONS_TABLE . " s, " . USERS_TABLE . " u
//			WHERE s.session_id = '$session_id'
//				AND u.user_id = s.session_user_id";
//-- add
		$sql = 'SELECT u.*, s.*, g.*
			FROM ' . SESSIONS_TABLE . ' s, ' . USERS_TABLE . ' u
				LEFT JOIN ' . GROUPS_TABLE . ' g
					ON g.group_user_id = u.user_id
			WHERE s.session_id = \'' . $session_id . '\'
				AND u.user_id = s.session_user_id';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
		$sql = "SELECT u.*, s.*
			FROM " . SESSIONS_TABLE . " s, " . USERS_TABLE . " u
			WHERE s.session_id = '$session_id'
				AND u.user_id = s.session_user_id";
*/
//-- add
		$sql = 'SELECT u.*, s.*, g.*
			FROM ' . SESSIONS_TABLE . ' s, ' . USERS_TABLE . ' u, ' . GROUPS_TABLE . ' g
			WHERE s.session_id = \'' . $session_id . '\'
				AND u.user_id = s.session_user_id
				AND g.group_user_id = s.session_user_id';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/topic_review.php
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config, $user, $censored_words, $icons, $navigation, $themes, $smilies;
	global $forums, $forum_id;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config, $user, $censored_words, $icons, $navigation, $themes, $smilies, $topics_attr;
	global $forums, $forum_id;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$added_fields = 't.topic_type, t.topic_first_post_id, t.topic_time, t.topic_duration, t.topic_sub_title, ';
		if ( defined('POST_CALENDAR') )
#
#-----[ REPLACE WITH ]----------------------------------------
#
		$added_fields = 't.topic_replies, t.topic_type, t.topic_sub_type, t.topic_first_post_id, t.topic_time, t.topic_duration, t.topic_sub_title, ';
		if ( $config->data['mod_topic_calendar_CH'] )
#
#-----[ FIND ]------------------------------------------------
#
			$forums->read();
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#

		// prepare title enhancement
		$front_title = new front_title();
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
//		$is_auth = auth(AUTH_ALL, $forum_id, $userdata, $forum_row);
//-- add
		$user->get_cache(POST_FORUM_URL);
		$is_auth = array(
			'auth_read' => $user->auth(POST_FORUM_URL, 'auth_read', $forum_id),
			'auth_read_type' => $user->lang('Auth_Users_granted_access'),
		);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
		$is_auth = auth(AUTH_ALL, $forum_id, $userdata, $forum_row);
*/
//-- add
		$user->get_cache(POST_FORUM_URL);
		$is_auth = array(
			'auth_view' => $user->auth(POST_FORUM_URL, 'auth_view', $forum_id),
			'auth_download' => $user->auth(POST_FORUM_URL, 'auth_download', $forum_id),
			'auth_read' => $user->auth(POST_FORUM_URL, 'auth_read', $forum_id),
			'auth_read_type' => $user->lang('Auth_Users_granted_access'),
		);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# This is a partial search : the full lines are longer
#
	$sql = "SELECT u.username,
		FROM " . POSTS_TABLE . " p,
		WHERE p.topic_id = $topic_id
			AND p.poster_id = u.user_id
			AND p.post_id = pt.post_id
		ORDER BY p.post_time DESC
		LIMIT " . $board_config['posts_per_page'];
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT pt.post_sub_title, ', $sql);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
*/
//-- add
	// generate pagination
	$ppage = _read('ppage', TYPE_INT);
	if ( $ppage < 5 )
	{
		$ppage = $config->data['posts_per_page'];
	}
	$start = _read('start', TYPE_INT);
	if ( $start < 0 )
	{
		$start = 0;
	}
	$total_posts = $forum_row['topic_replies'] + 1;
	$parms = array(
		'mode' => 'topicreview',
		POST_TOPIC_URL => $topic_id,
	);
	if ( $ppage != $config->data['posts_per_page'] )
	{
		$parms += array(
			'ppage' => $ppage,
		);
	}
	$pagination = new pagination('posting', $parms);
	$pagination->display('pagination', $total_posts, $config->data['posts_per_page'], $start, true, 'Posts_count');

	// read posts
	$sql = 'SELECT p.*, pt.post_text, pt.post_subject, pt.bbcode_uid, pt.post_sub_title, u.user_id, u.username
				FROM ' . POSTS_TABLE . ' p, ' . POSTS_TEXT_TABLE . ' pt, ' . USERS_TABLE . ' u
				WHERE p.topic_id = ' . intval($topic_id) . '
					AND p.poster_id = u.user_id
					AND pt.post_id = p.post_id
				ORDER BY p.post_time DESC
				LIMIT ' . $start . ', ' . $ppage;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			// get icon
			if ( !$is_inline_review )
			{
				// message icon
				$icons->topic_title('postrow', $row['post_icon'], ($forum_row['topic_first_post_id'] == $row['post_id']) ? (($forum_row['topic_type'] > POST_NORMAL) ? $forum_row['topic_type'] : ($forum_row['topic_calendar_time'] ? POST_CALENDAR : '')) : '');

				// sub title
				$front_sub_title = new front_sub_title();
				$front_sub_title->topic_title('postrow', $row['post_sub_title'], intval($config->data['sub_title_length']));
				unset($front_sub_title);

				// first post of the topic, get additional information for the subject
				if ( $forum_row['topic_first_post_id'] == $row['post_id'] )
				{
					// announce
					$front_announce = new front_announce();
					$front_announce->topic_title('postrow', $forum_row['topic_time'], $forum_row['topic_duration']);
					unset($front_announce);

					// calendar
					$front_calendar = new front_calendar();
					$front_calendar->topic_title('postrow', $forum_row['topic_calendar_time'], $forum_row['topic_calendar_duration']);
					unset($front_calendar);
				}
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ REPLACE WITH ]----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			// enhance the topic title
			if ( !$is_inline_review )
			{
				$front_title->set('postrow', array_merge($forum_row, $row), $forum_row['topic_first_post_id'] == $row['post_id']);
			}
			$template->set_switch('postrow.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_viewprofile.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- fix : wrong username recog ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$profiledata = get_userdata($HTTP_GET_VARS[POST_USERS_URL]);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- fix : wrong username recog ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$profiledata = get_userdata(intval($HTTP_GET_VARS[POST_USERS_URL]));
//-- fin fix : wrong username recog --------------------------------------------
#
#
#
#
##############################################################
##
## language changelog
##
##	nb.: consider also lang_CH_install.php
##
##############################################################
#
#-----[ OPEN ]------------------------------------------------
#
language/lang_english/lang_extend_auth_center.php
#
#-----[ FIND ]------------------------------------------------
#
 *	version				: 0.0.6 - 12/02/2005
#
#-----[ REPLACE WITH ]----------------------------------------
#
 *	version				: 0.0.8 - 21/08/2005
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Board_founder_explain'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['Board_founder_explain'] = 'Note : the Main administrators group doesn\'t require any permissions to be set : it has already all authorised.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['auth_announce'] =
	$lang['auth_global_announce'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['auth_announce'] = 'Create announcements';
	$lang['auth_global_announce'] = 'Create global announcement';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Preset_admin'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$lang['Preset_guest_posting'] = 'Guest post and reply';
#
#-----[ OPEN ]------------------------------------------------
#
language/lang_english/lang_extend_cat_hierarchy.php
#
#-----[ FIND ]------------------------------------------------
#
 *	version				: 0.0.10 - 11/02/2005
#
#-----[ REPLACE WITH ]----------------------------------------
#
 *	version				: 0.0.12 - 21/08/2005
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Lang_extend_cat_hierarchy'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$lang['Extended_template_CH'] = 'Extended template CH edition';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Forum_link_hit_count'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$lang['Forum_subs_hidden'] = 'Hide sub-forums list';
	$lang['Forum_subs_hidden_explain'] = 'Allow to hide the sub-forums list appearing under the forum name in the forum cell of the index page.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Topics_split_global'] =
	$lang['Topics_split_announces'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['Topics_split_global'] = 'Split global announcements from regular announcements';
	$lang['Topics_split_announces'] = 'Split Announcements from regular et sticky topics';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Board_box_content'] =
	$lang['Board_box_content_explain'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['Board_box_content'] = 'Board announcements setup';
	$lang['Board_box_content_explain'] = 'Choose what kind of announcements you want to display in the board announcements box.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Global_Parent_announces'] =
	$lang['Global_Childs_announces'] =
	$lang['Global_Branch_announces'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['Global_Parent_announces'] = 'Global and parent-forums announcements';
	$lang['Global_Childs_announces'] = 'Global and sub-forums announcements';
	$lang['Global_Branch_announces'] = 'Global and whole-section announcements';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Enable_cache_moderators'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$lang['Enable_cache_topics_attr'] = 'Enable topic title attributes list cache';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Cache_failed_moderators'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$lang['Cache_failed_topics_attr'] = 'Topic title attributes list cache failed. The cache has been disabled.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Cache_succeed_moderators'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$lang['Cache_succeed_topics_attr'] = 'Topic title attributes list cache succeed. The cache has been enabled.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Icon_acl'] =
	$lang['Icon_acl_explain'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['Icon_auth'] = 'Authorisation required';
	$lang['Icon_auth_explain'] = 'Choose which authorisation will be required to use this icon.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Top'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#

	// topics attributes admin
	$lang['Topics_attr_settings'] = 'Topic title attributes';
	$lang['Topics_attr_admin'] = 'Topic title attributes management';
	$lang['Topics_attr_admin_explain'] = 'Here you can edit, delete, create and re-order text and icons used in front of topic titles.';
	$lang['Topics_attr_create'] = 'Create a topic title attribute';
	$lang['Topics_attr_create_explain'] = 'Here you register a new topic title attribute. You can use $lang entry keys for legends. Images will be picked up from the $images entries (Check templates/<i>your_template</i>/<i>your_template</i>.cfg).';
	$lang['Topics_attr_edit'] = 'Edit a topic title attribute';
	$lang['Topics_attr_edit_explain'] = 'Here you can modify the topic title attribute definition and priviledges. Images will be picked up from the $images entries (Check templates/<i>your_template</i>/<i>your_template</i>.cfg).';
	$lang['Topics_attr_delete'] = 'Delete a topics title attribute';
	$lang['Topics_attr_delete_explain'] = 'Here you can delete a topic title attribute.';

	$lang['Topics_attr_folder'] = 'Folder';
	$lang['Topics_attr_title'] = 'Title';
	$lang['Topics_attr_name'] = 'Attribute name';
	$lang['Topics_attr_name_explain'] = 'Set here the attribute name you want to see in the drop down lists.';
	$lang['Topics_attr_fname'] = 'Mouseover folder name';
	$lang['Topics_attr_fname_explain'] = 'Set here the name the folder image will have when the mouse will be over it.';
	$lang['Topics_attr_fimg'] = 'Folder image';
	$lang['Topics_attr_fimg_explain'] = 'This will be the folder image used when the condition will be fullfilled.';
	$lang['Topics_attr_tname'] = 'Tag';
	$lang['Topics_attr_tname_explain'] = 'This will be the tag used in front of the topic title.';
	$lang['Topics_attr_timg'] = 'Tag image';
	$lang['Topics_attr_timg_explain'] = 'If provided, the image will be displayed in place of the tag.';
	$lang['Topics_attr_field'] = 'Topics field to check';
	$lang['Topics_attr_field_explain'] = 'Set here the condition that will be used to check the topic title attribute.';
	$lang['Topics_attr_auth'] = 'Authorisation required';
	$lang['Topics_attr_auth_explain'] = 'Choose which authorisation will be required to use this topic attribute. This one is only use for the topic sub type.';

	$lang['Topics_attr_ttype'] = 'Topic type';
	$lang['Topics_attr_tsubtype'] = 'Topic sub type';
	$lang['Topics_attr_tmoved'] = 'Shadow topic';
	$lang['Topics_attr_tstatus'] = 'Topic is locked';
	$lang['Topics_attr_tvote'] = 'Topic has a poll';
	$lang['Topics_attr_tattach'] = 'Topic has an attached file';
	$lang['Topics_attr_tcalendar'] = 'Topic is a calendar event';

	$lang['Topics_attr_after'] = 'Folder image priority is just less than';
	$lang['Topics_attr_replace'] = 'Replace with attribute';
	$lang['Topics_attr_replace_explain'] = 'Choose a sub type to replace in topics the one to delete. Choose "None" to reset this sub type in topic using it.';

	$lang['Topics_attr_not_exists'] = 'This topic title attribute does not exist.';
	$lang['Topics_attr_created'] = 'The topic title attribute has been created.';
	$lang['Topics_attr_edited'] = 'The topic title attribute has been edited.';
	$lang['Topics_attr_deleted'] = 'The topic title attribute has been deleted.';

	$lang['Click_return_topics_attr_admin'] = 'Click %sHere%s to return to Topic title attributes administration.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Default_duration'] =
	$lang['Default_duration_explain'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
	$lang['Default_duration'] = 'Announcements default duration';
	$lang['Default_duration_explain'] = 'Default duration proposed while writing an announcement.';
#
#-----[ FIND ]------------------------------------------------
#
	$lang['Sub_title_length_explain'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#

	// versions check
	$lang['version_checked'] = '&nbsp;&nbsp;&nbsp;&raquo; <b>%s</b>: your version is <b>%s</b>, last available version is <b>%s</b>';
	$lang['version_not_checked'] = '&nbsp;&nbsp;&nbsp;&raquo; <b>%s</b>: your version is <b>%s</b>';
	$lang['Unknown'] = 'Unknown';
#
#-----[ FIND ]------------------------------------------------
#
$lang['User_delete_deny'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
$lang['Auth_read_required'] = 'Only users users granted special access can access topics in this forum.';
$lang['Registration_required'] = 'You must register to access topics in this forum.';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Board_announces'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Board_announces'] = 'Board Announcements';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Global_Announces'] =
$lang['Announces'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Global_Announces'] = 'Global Announcements';
$lang['Announces'] = 'Announcements';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Announce_ends'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Announce_ends'] = 'Announcement end: %s';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Topic_duration_explain'] =
$lang['Topic_duration_special'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Topic_duration_explain'] = 'This is the date an announcement will stop to appear in other forums as a global announcement or a board announcement.';
$lang['Topic_duration_special'] = 'Choose "Never displayed" to never show this announcement elsewhere than in its own forum. <br />Choose "Always displayed" to display it forever.';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Always_displayed'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
$lang['New_post_meanwhile_reply'] = 'A new reply has been posted or the last post has been deleted while you were replying. Check the "Topic review" at bottom of this page, and resubmit your post if appropriate.';
$lang['New_post_meanwhile_edit'] = 'A new reply has been posted or the last post has been deleted while you were editing.';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Board_box_display'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Board_box_display'] = 'Display Board announcements box';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Index_pack_explain'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Index_pack_explain'] = 'If set, categories will appear with a forum layer.';
#
#-----[ FIND ]------------------------------------------------
#
$lang['Index_split_explain'] =
#
#-----[ REPLACE WITH ]----------------------------------------
#
$lang['Index_split_explain'] = 'If set, categories will be splited from each other. This setup is ignored if "Pack sub-categories" is On.';
#
#-----[ FIND ]------------------------------------------------
#
$lang['dbg_requester'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#

// operand
$lang['Less'] = 'Less than';
$lang['Less_equal'] = 'Less or Equal to';
$lang['Equal'] = 'Equal to';
$lang['Greater_equal'] = 'Greater or Equal to';
$lang['Greater'] = 'Greater than';
$lang['Not_equal'] = 'Not equal to';

// topic title attribute
$lang['Topic_sub_type'] = 'Add a tag to the title';

// calendar
$lang['Topic_calendar'] = 'Event';

// access key commands (keyboard shortcuts)
$lang['cmd_submit'] = 's';
$lang['cmd_select'] = 's';
$lang['cmd_delete'] = 'x';
$lang['cmd_edit'] = 'e';
$lang['cmd_create'] = 'c';
$lang['cmd_cancel'] = 'a';
$lang['cmd_synchro'] = 'y';
$lang['cmd_add_group'] = 'g';
$lang['cmd_regen'] = 'r';
$lang['cmd_preview'] = 'p';
$lang['cmd_up'] = '-';
$lang['cmd_down'] = '+';
$lang['cmd_export'] = 'o';

// timezone
$lang['UTC_DST'] = 'UTC %s %s (DST in action)';
$lang['UTC'] = 'UTC %s %s';
$lang['dst'] = 'Summertime';
$lang['dst_explain'] = 'Adjust the time for summer (add 1 hour in summer)';
$lang['tz_suggest'] = 'Synchronise';
$lang['tz_suggest_explain'] = 'Try to find your closest timezone';
#
#
#
#
#
#
##############################################################
##
## subSilver changelog
##
##	nb.: if you don't use subSilver but ptifo, you can skip this
##
##
##	- posting_bbcode.tpl has been built with extracting from posting_body.tpl all the javascript functions
##	- topics_row_box.tpl has been built with extracting from topics_box.tpl what refers to the topics rows
##
##############################################################
#
#-----[ DIY INSTRUCTIONS ]------------------------------------
#
DELETE templates/subSilver/admin/caches_body.tpl
DELETE templates/subSilver/admin/forum_details_body.tpl
DELETE templates/subSilver/admin/icons_details_body.tpl
#
#-----[ DIY INSTRUCTIONS ]------------------------------------
#
RENAME templates/subSilver/profile_add_body.tpl TO _sav_profile_add_body.tpl
#
#-----[ COPY ]------------------------------------------------
#
COPY root/templates/subSilver/images/*.* TO templates/subSilver/images/*.*
#
#-----[ COPY ]------------------------------------------------
#
COPY root/templates/subSilver/admin/auth_overview_body.tpl TO templates/subSilver/admin/auth_overview_body.tpl
COPY root/templates/subSilver/admin/auth_overview_group_body.tpl TO templates/subSilver/admin/auth_overview_group_body.tpl
COPY root/templates/subSilver/admin/auths_def_body.tpl TO templates/subSilver/admin/auths_def_body.tpl
COPY root/templates/subSilver/admin/forum_flat_body.tpl TO templates/subSilver/admin/forum_flat_body.tpl
COPY root/templates/subSilver/admin/forum_fprune_body.tpl TO templates/subSilver/admin/forum_fprune_body.tpl
COPY root/templates/subSilver/admin/forum_index_body.tpl TO templates/subSilver/admin/forum_index_body.tpl
COPY root/templates/subSilver/admin/icons_list_body.tpl TO templates/subSilver/admin/icons_list_body.tpl
COPY root/templates/subSilver/admin/topics_attr_list_body.tpl TO templates/subSilver/admin/topics_attr_list_body.tpl
#
#-----[ COPY ]------------------------------------------------
#
COPY root/templates/subSilver/cp_generic.tpl TO templates/subSilver/cp_generic.tpl
COPY root/templates/subSilver/cp_menus_box.tpl TO templates/subSilver/cp_menus_box.tpl
COPY root/templates/subSilver/form_body.tpl TO templates/subSilver/form_body.tpl
COPY root/templates/subSilver/form_fields.tpl TO templates/subSilver/form_fields.tpl
COPY root/templates/subSilver/index_stats_box.tpl TO templates/subSilver/index_stats_box.tpl
COPY root/templates/subSilver/modcp_body.tpl TO templates/subSilver/modcp_body.tpl
COPY root/templates/subSilver/posting_bbcode.tpl TO templates/subSilver/posting_bbcode.tpl
COPY root/templates/subSilver/posting_icon_box.tpl TO templates/subSilver/posting_icon_box.tpl
COPY root/templates/subSilver/profile_add_body.tpl TO templates/subSilver/profile_add_body.tpl
COPY root/templates/subSilver/search_results_topics.tpl TO templates/subSilver/search_results_topics.tpl
COPY root/templates/subSilver/stat_run_body.tpl TO templates/subSilver/stat_run_body.tpl
COPY root/templates/subSilver/subSilver.ini TO templates/subSilver/subSilver.ini
COPY root/templates/subSilver/topics_bottom_forum.tpl TO templates/subSilver/topics_bottomforum.tpl
COPY root/templates/subSilver/topics_bottom_modcp.tpl TO templates/subSilver/topics_bottom_modcp.tpl
COPY root/templates/subSilver/topics_bottom_search.tpl TO templates/subSilver/topics_bottom_search.tpl
COPY root/templates/subSilver/topics_box.tpl TO templates/subSilver/topics_box.tpl
COPY root/templates/subSilver/topics_row_box.tpl TO templates/subSilver/topics_row_box.tpl
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/index_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row2"><b>{DB_SIZE}</b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row2"><b>&nbsp;{DB_SIZE}&nbsp;</b></td>
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row2"><b>{GZIP_COMPRESSION}</b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row2"><b>&nbsp;{GZIP_COMPRESSION}&nbsp;</b></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/index_navigate.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
<img src="../templates/subSilver/images/logo_phpBB_med.gif"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
../templates/subSilver/images/logo_phpBB_med.gif
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{I_LOGO_SMALL}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/page_footer.tpl
#
#-----[ FIND ]------------------------------------------------
#
</body>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE stat_run_body.tpl -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/page_header.tpl
#
#-----[ FIND ]------------------------------------------------
#
<style type="text/css">
<!--
#
#-----[ AFTER, ADD ]------------------------------------------
#

.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/agreement.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr>
		<td align="left"><span class="nav"><a class="nav" href="{U_INDEX}">{L_INDEX}</a></span></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/groupcp_info_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
<span class="gen"><span class="gen">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<span class="gen"><span class="gen">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<span class="gen">
#
#-----[ FIND ]------------------------------------------------
#
		<td class="catBottom" colspan="8" align="right"><span class="cattitle">
			<input type="submit" name="remove" value="{L_REMOVE_SELECTED}" class="mainoption" />
		</td>
#
#----------[ IN-LINE FIND ]-----------------------------------
#
</td>
#
#----------[ IN-LINE BEFORE, ADD ]----------------------------
#
</span>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/index_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="0" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left" valign="bottom"><span class="gensmall">
	<!-- BEGIN switch_user_logged_in -->
	{LAST_VISIT_DATE}<br />
	<!-- END switch_user_logged_in -->
	{CURRENT_TIME}<br />
	{S_TIMEZONE}
	</span></td>
	<td align="right" valign="bottom" class="gensmall">
		<a href="{U_SEARCH_NEW}" class="gensmall">{L_SEARCH_NEW}</a><br />
		<!-- BEGIN switch_user_logged_in -->
		<a href="{U_SEARCH_SELF}" class="gensmall">{L_SEARCH_SELF}</a><br />
		<!-- END switch_user_logged_in -->
		<a href="{U_SEARCH_UNANSWERED}" class="gensmall">{L_SEARCH_UNANSWERED}</a></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
# Fix tabulations : it doesn't matter if you don't do this
#
<table width="100%" cellspacing="0" cellpadding="2" border="0" align="center">
<tr>
	<td align="left" valign="bottom"><span class="gensmall">
		<!-- BEGIN switch_user_logged_in -->
		{LAST_VISIT_DATE}<br />
		<!-- END switch_user_logged_in -->
		{CURRENT_TIME}<br />
		{S_TIMEZONE}
	</span></td>
	<td align="right" valign="bottom" class="gensmall">
		<a href="{U_SEARCH_NEW}" class="gensmall">{L_SEARCH_NEW}</a><br />
		<!-- BEGIN switch_user_logged_in -->
		<a href="{U_SEARCH_SELF}" class="gensmall">{L_SEARCH_SELF}</a><br />
		<!-- END switch_user_logged_in -->
		<a href="{U_SEARCH_UNANSWERED}" class="gensmall">{L_SEARCH_UNANSWERED}</a>
	</td>
</tr>
</table>
#
#-----[ FIND ]------------------------------------------------
#
<!-- BEGIN board_topics_spacing -->
<br class="nav" />
<!-- END board_topics_spacing -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- BEGIN board_topics_spacing --><br class="nav" /><!-- END board_topics_spacing -->
#
#-----[ FIND ]------------------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<form method="post" action="{S_ACTION}">
#
#-----[ FIND ]------------------------------------------------
#
	<th colspan="2" class="thCornerL" height="25" nowrap="nowrap">&nbsp;{L_FORUM}&nbsp;</th>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<th colspan="2" class="thCornerL" height="25" nowrap="nowrap" width="100%">&nbsp;{L_FORUM}&nbsp;</th>
#
#-----[ FIND ]------------------------------------------------
#
	<td class="rowpic" colspan="3" align="right" width="340">&nbsp;</td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="rowpic" colspan="3" align="right">&nbsp;</td>
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row1" height="50">
		<!-- BEGIN forum_icon -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row1" height="50" width="100%">
		<!-- BEGIN forum_icon -->
#
#-----[ FIND ]------------------------------------------------
#
			<b>{L_MODERATORS}:&nbsp;</b>
			<!-- BEGIN mod -->
			<a href="{indexrow.forum.row.moderators.mod.U_MOD}" title="{indexrow.forum.row.moderators.mod.L_MOD_TITLE}" class="gensmall">{indexrow.forum.row.moderators.mod.L_MOD}</a>{indexrow.forum.row.moderators.mod.L_SEP}
			<!-- END mod -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
			<b>{L_MODERATORS}:&nbsp;</b><!-- BEGIN mod --><a href="{indexrow.forum.row.moderators.mod.U_MOD}" title="{indexrow.forum.row.moderators.mod.L_MOD_TITLE}" class="gensmall">{indexrow.forum.row.moderators.mod.L_MOD}</a><!-- BEGIN sep -->, <!-- END sep --><!-- END mod -->
#
#-----[ FIND ]------------------------------------------------
#
			<b>{L_SUBFORUMS}:&nbsp;</b>
			<!-- BEGIN sub -->
			<img src="{indexrow.forum.row.subforums.sub.I_SUB}" border="0" align="middle" alt="{indexrow.forum.row.subforums.sub.L_SUB_ALT}" title="{indexrow.forum.row.subforums.sub.L_SUB_ALT}" /><a href="{indexrow.forum.row.subforums.sub.U_SUB}" title="{indexrow.forum.row.subforums.sub.L_SUB_DESC}" class="gensmall">{indexrow.forum.row.subforums.sub.L_SUB}</a>{indexrow.forum.row.subforums.sub.L_SEP}
			<!-- END sub -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
			<b>{L_SUBFORUMS}:</b>&nbsp;<!-- BEGIN sub --><img src="{indexrow.forum.row.subforums.sub.I_SUB}" border="0" align="middle" alt="{indexrow.forum.row.subforums.sub.L_SUB_ALT}" title="{indexrow.forum.row.subforums.sub.L_SUB_ALT}" hspace="2" /><a href="{indexrow.forum.row.subforums.sub.U_SUB}" title="{indexrow.forum.row.subforums.sub.L_SUB_DESC}" class="gensmall">{indexrow.forum.row.subforums.sub.L_SUB}</a><!-- BEGIN sep -->, <!-- END sep --><!-- END sub -->
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row2" align="center" valign="middle" height="50"><span class="gensmall">{indexrow.forum.TOPICS}</span></td>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
	<!-- BEGIN auth_read -->
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row3right" align="center" valign="middle" height="50" nowrap="nowrap"><span class="gensmall">
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row3Right" align="center" valign="middle" height="50" nowrap="nowrap"><span class="gensmall">
#
#-----[ FIND ]------------------------------------------------
#
		<!-- BEGIN userlink -->
		<a href="{indexrow.forum.U_LAST_POSTER}" class="gensmall" title="{L_LAST_POSTER}">{indexrow.forum.LAST_POSTER}</a>
		<!-- END userlink -->
		<!-- BEGIN userlink_ELSE -->
		{indexrow.forum.LAST_POSTER}
		<!-- END userlink_ELSE -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<!-- BEGIN userlink --><a href="{indexrow.forum.U_LAST_POSTER}" class="gensmall" title="{L_LAST_POSTER}"><!-- END userlink -->{indexrow.forum.LAST_POSTER}<!-- BEGIN userlink --></a><!-- END userlink -->
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
		<a href="{indexrow.forum.U_LAST_POST}" class="gensmall" title="{L_LAST_POST}">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<a href="{indexrow.forum.U_LAST_POST}"
#
#----------[ IN-LINE BEFORE, ADD ]----------------------------
#
&nbsp;
#
#-----[ FIND ]------------------------------------------------
#
		<!-- END last_post -->
		<!-- BEGIN last_post_ELSE -->
		{L_NO_POSTS}
		<!-- END last_post_ELSE -->
		</span>
	</td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<!-- BEGINELSE last_post -->
		{L_NO_POSTS}
		<!-- END last_post -->
	</span></td>
	<!-- BEGINELSE auth_read -->
	<td class="row3Right" colspan="3" align="center"><span class="gensmall">
		{L_AUTH_REQ}
	</span></td>
	<!-- END auth_read -->
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row1" height="50">
		<!-- BEGIN forum_icon -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row1" height="50" width="100%">
		<!-- BEGIN forum_icon -->
#
#-----[ FIND ]------------------------------------------------
#
			<b>{L_SUBFORUMS}:&nbsp;</b>
			<!-- BEGIN sub -->
			<img src="{indexrow.link.row.subforums.sub.I_SUB}" border="0" align="middle" alt="{indexrow.link.row.subforums.sub.L_SUB_ALT}" title="{indexrow.link.row.subforums.sub.L_SUB_ALT}" /><a href="{indexrow.link.row.subforums.sub.U_SUB}" title="{indexrow.link.row.subforums.sub.L_SUB_DESC}" class="gensmall">{indexrow.link.row.subforums.sub.L_SUB}</a>{indexrow.link.row.subforums.sub.L_SEP}
			<!-- END sub -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
			<b>{L_SUBFORUMS}:</b>&nbsp;<!-- BEGIN sub --><img src="{indexrow.link.row.subforums.sub.I_SUB}" border="0" align="middle" alt="{indexrow.link.row.subforums.sub.L_SUB_ALT}" title="{indexrow.link.row.subforums.sub.L_SUB_ALT}" hspace="2" /><a href="{indexrow.link.row.subforums.sub.U_SUB}" title="{indexrow.link.row.subforums.sub.L_SUB_DESC}" class="gensmall">{indexrow.link.row.subforums.sub.L_SUB}</a><!-- BEGIN sep -->, <!-- END sep --><!-- END sub -->
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row3right" align="center" valign="middle" height="50" colspan="3" width="340"><span class="gensmall">{indexrow.link.HITS}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row3Right" align="center" valign="middle" height="50" colspan="3" width="340"><span class="gensmall">
		{indexrow.link.HITS}
	</span></td>
#
#-----[ FIND ]------------------------------------------------
#
<!-- BEGIN spacing -->
<br class="nav" />
<!-- END spacing -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- BEGIN spacing --><br class="nav" /><!-- END spacing -->
#
#-----[ FIND ]------------------------------------------------
#
<!-- BEGIN forums_spacing -->
<br class="nav" />
<!-- END forums_spacing -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- BEGIN forums_spacing --><br class="nav" /><!-- END forums_spacing -->
#
#-----[ FIND ]------------------------------------------------
#
{NAVIGATION_ONLY_BOX}
#
#-----[ AFTER, ADD ]------------------------------------------
#
</form>
#
#-----[ FIND ]------------------------------------------------
#
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr>
	<td nowrap="nowrap" align="right"><span class="gensmall">{JUMPBOX}</span></td>
</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr>
	<td nowrap="nowrap" align="right">{JUMPBOX}</td>
</tr>
</table>
<br />
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellpadding="3" cellspacing="1" border="0" class="forumline"><form method="post" action="{S_LOGIN_ACTION}">
#
#-----[ REPLACE WITH ]----------------------------------------
#
<form method="post" action="{S_LOGIN_ACTION}"><table width="100%" cellpadding="3" cellspacing="1" border="0" class="forumline">
#
#-----[ FIND ]------------------------------------------------
#
</tr></form>
</table>
<!-- END switch_user_logged_out -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
</tr>
</table></form>
<!-- END switch_user_logged_out -->
#
#-----[ FIND ]------------------------------------------------
#
	<td width="20" align="center"><img src="{FORUM_NEW_IMG}" alt="{L_NEW_POSTS}"/></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td width="20" align="center"><img src="{FORUM_NEW_IMG}" alt="{L_NEW_POSTS}" /></td>
#
#-----[ FIND ]------------------------------------------------
#
	<td><span class="gensmall">{L_FORUM_LOCKED}</span></td>
#
#-----[ AFTER, ADD ]------------------------------------------
#
	<td>&nbsp;&nbsp;</td>
	<td width="20" align="center"><img src="{FORUM_LINK_IMG}" alt="{L_FORUM_LINK}" /></td>
	<td><span class="gensmall">{L_FORUM_LINK}</span></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/jumpbox.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
onSubmit="if(document.jumpbox.f.value == -1){return false;}"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
== -1
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
< 0
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/message_body.tpl
#
#-----[ FIND ]------------------------------------------------
# 
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr>
		<td align="left" class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/modcp_split.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
<img src="templates/subSilver/images/icon_minipost.gif"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
templates/subSilver/images/icon_minipost.gif
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{I_POST}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/navigation_box.tpl
#
#-----[ FIND ]------------------------------------------------
#
	<!-- BEGIN nav -->
	<!-- BEGIN img -->
	<img src="{nav.I_NAV}" border="0" align="absbottom" />
	<!-- END img -->
	<a href="{nav.U_NAV}" title="{nav.L_NAV_DESC}" class="nav">{nav.L_NAV}</a>
	<!-- BEGIN sep -->
	&raquo;
	<!-- END sep -->
	<!-- END nav -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
# pack all of this into one line
#
		<!-- BEGIN nav --><!-- BEGIN img --><img src="{nav.I_NAV}" border="0" class="absbottom" alt="" />&nbsp;<!-- END img --><a href="{nav.U_NAV}" title="{nav.L_NAV_DESC}" class="nav">{nav.L_NAV}</a><!-- BEGIN sep --> &raquo;&nbsp;<!-- END sep --><!-- END nav -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/navigation_only_box.tpl
#
#-----[ FIND ]------------------------------------------------
#
	<!-- BEGIN nav -->
	<!-- BEGIN img -->
	<img src="{nav.I_NAV}" border="0" align="absbottom" />
	<!-- END img -->
	<a href="{nav.U_NAV}" title="{nav.L_NAV_DESC}" class="nav">{nav.L_NAV}</a>
	<!-- BEGIN sep -->
	&raquo;
	<!-- END sep -->
	<!-- END nav -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
# same thing
#
		<!-- BEGIN nav --><!-- BEGIN img --><img src="{nav.I_NAV}" border="0" class="absbottom" alt="" />&nbsp;<!-- END img --><a href="{nav.U_NAV}" title="{nav.L_NAV_DESC}" class="nav">{nav.L_NAV}</a><!-- BEGIN sep --> &raquo;&nbsp;<!-- END sep --><!-- END nav -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/overall_footer.tpl
#
#-----[ FIND ]------------------------------------------------
#
</body>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE stat_run_body.tpl -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/overall_header.tpl
#
#-----[ FIND ]------------------------------------------------
#
<style type="text/css">
<!--
#
#-----[ AFTER, ADD ]------------------------------------------
#

.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
<img src="templates/subSilver/images/logo_phpBB.gif"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
templates/subSilver/images/logo_phpBB.gif
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{I_LOGO}
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
&nbsp;<a href="{U_FAQ}"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
&nbsp;<a href="{U_FAQ}"
#
#----------[ IN-LINE BEFORE, ADD ]----------------------------
#
<!-- BEGIN topic_calendar -->&nbsp;<a href="{U_CALENDAR}" class="mainmenu"><img src="{I_CALENDAR}" width="12" height="13" border="0" alt="{L_CALENDAR}" hspace="3" />{L_CALENDAR}</a>&nbsp; <!-- END topic_calendar -->
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
{L_REGISTER}</a></span>&nbsp;
#
#----------[ IN-LINE FIND ]-----------------------------------
#
{L_REGISTER}</a></span>&nbsp;
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{L_REGISTER}</a>&nbsp;
#
#-----[ FIND ]------------------------------------------------
#
						<!-- END switch_user_logged_out -->
						</td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
						<!-- END switch_user_logged_out -->
						</span></td>
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
<a href="{U_PREFERENCES}" class="mainmenu"><img src="templates/subSilver/images/icon_mini_profile.gif"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
icon_mini_profile.gif
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
icon_mini_preferences.gif
#
#-----[ FIND ]------------------------------------------------
#
		</table>

		<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
		{CALENDAR_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/posting_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
# All the javascript for bbcode part is to be moved to a new file : posting_bbcode.tpl, as is
#
<script language="JavaScript" type="text/javascript">
<!--
// bbCode control by
// subBlue design
// www.subBlue.com

// Startup variables
var imageTag = false;
var theSelection = false;

// Check for Browser & Platform for PC & IE specific bits
// More details from: http://www.mozilla.org/docs/web-developer/sniffer/browser_type.html
var clientPC = navigator.userAgent.toLowerCase(); // Get client info
var clientVer = parseInt(navigator.appVersion); // Get browser version

var is_ie = ((clientPC.indexOf("msie") != -1) && (clientPC.indexOf("opera") == -1));
var is_nav = ((clientPC.indexOf('mozilla')!=-1) && (clientPC.indexOf('spoofer')==-1)
                && (clientPC.indexOf('compatible') == -1) && (clientPC.indexOf('opera')==-1)
                && (clientPC.indexOf('webtv')==-1) && (clientPC.indexOf('hotjava')==-1));
var is_moz = 0;

var is_win = ((clientPC.indexOf("win")!=-1) || (clientPC.indexOf("16bit") != -1));
var is_mac = (clientPC.indexOf("mac")!=-1);

// Helpline messages
b_help = "{L_BBCODE_B_HELP}";
i_help = "{L_BBCODE_I_HELP}";
u_help = "{L_BBCODE_U_HELP}";
q_help = "{L_BBCODE_Q_HELP}";
c_help = "{L_BBCODE_C_HELP}";
l_help = "{L_BBCODE_L_HELP}";
o_help = "{L_BBCODE_O_HELP}";
p_help = "{L_BBCODE_P_HELP}";
w_help = "{L_BBCODE_W_HELP}";
a_help = "{L_BBCODE_A_HELP}";
s_help = "{L_BBCODE_S_HELP}";
f_help = "{L_BBCODE_F_HELP}";

// Define the bbCode tags
bbcode = new Array();
bbtags = new Array('[b]','[/b]','[i]','[/i]','[u]','[/u]','[quote]','[/quote]','[code]','[/code]','[list]','[/list]','[list=]','[/list]','[img]','[/img]','[url]','[/url]');
imageTag = false;

// Shows the help messages in the helpline window
function helpline(help) {
	document.post.helpbox.value = eval(help + "_help");
}


// Replacement for arrayname.length property
function getarraysize(thearray) {
	for (i = 0; i < thearray.length; i++) {
		if ((thearray[i] == "undefined") || (thearray[i] == "") || (thearray[i] == null))
			return i;
		}
	return thearray.length;
}

// Replacement for arrayname.push(value) not implemented in IE until version 5.5
// Appends element to the array
function arraypush(thearray,value) {
	thearray[ getarraysize(thearray) ] = value;
}

// Replacement for arrayname.pop() not implemented in IE until version 5.5
// Removes and returns the last element of an array
function arraypop(thearray) {
	thearraysize = getarraysize(thearray);
	retval = thearray[thearraysize - 1];
	delete thearray[thearraysize - 1];
	return retval;
}


function checkForm() {

	formErrors = false;    

	if (document.post.message.value.length < 2) {
		formErrors = "{L_EMPTY_MESSAGE}";
	}

	if (formErrors) {
		alert(formErrors);
		return false;
	} else {
		bbstyle(-1);
		//formObj.preview.disabled = true;
		//formObj.submit.disabled = true;
		return true;
	}
}

function emoticon(text) {
	var txtarea = document.post.message;
	text = ' ' + text + ' ';
	if (txtarea.createTextRange && txtarea.caretPos) {
		var caretPos = txtarea.caretPos;
		caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? caretPos.text + text + ' ' : caretPos.text + text;
		txtarea.focus();
	} else {
		txtarea.value  += text;
		txtarea.focus();
	}
}

function bbfontstyle(bbopen, bbclose) {
	var txtarea = document.post.message;

	if ((clientVer >= 4) && is_ie && is_win) {
		theSelection = document.selection.createRange().text;
		if (!theSelection) {
			txtarea.value += bbopen + bbclose;
			txtarea.focus();
			return;
		}
		document.selection.createRange().text = bbopen + theSelection + bbclose;
		txtarea.focus();
		return;
	}
	else if (txtarea.selectionEnd && (txtarea.selectionEnd - txtarea.selectionStart > 0))
	{
		mozWrap(txtarea, bbopen, bbclose);
		return;
	}
	else
	{
		txtarea.value += bbopen + bbclose;
		txtarea.focus();
	}
	storeCaret(txtarea);
}


function bbstyle(bbnumber) {
	var txtarea = document.post.message;

	txtarea.focus();
	donotinsert = false;
	theSelection = false;
	bblast = 0;

	if (bbnumber == -1) { // Close all open tags & default button names
		while (bbcode[0]) {
			butnumber = arraypop(bbcode) - 1;
			txtarea.value += bbtags[butnumber + 1];
			buttext = eval('document.post.addbbcode' + butnumber + '.value');
			eval('document.post.addbbcode' + butnumber + '.value ="' + buttext.substr(0,(buttext.length - 1)) + '"');
		}
		imageTag = false; // All tags are closed including image tags :D
		txtarea.focus();
		return;
	}

	if ((clientVer >= 4) && is_ie && is_win)
	{
		theSelection = document.selection.createRange().text; // Get text selection
		if (theSelection) {
			// Add tags around selection
			document.selection.createRange().text = bbtags[bbnumber] + theSelection + bbtags[bbnumber+1];
			txtarea.focus();
			theSelection = '';
			return;
		}
	}
	else if (txtarea.selectionEnd && (txtarea.selectionEnd - txtarea.selectionStart > 0))
	{
		mozWrap(txtarea, bbtags[bbnumber], bbtags[bbnumber+1]);
		return;
	}
	
	// Find last occurance of an open tag the same as the one just clicked
	for (i = 0; i < bbcode.length; i++) {
		if (bbcode[i] == bbnumber+1) {
			bblast = i;
			donotinsert = true;
		}
	}

	if (donotinsert) {		// Close all open tags up to the one just clicked & default button names
		while (bbcode[bblast]) {
				butnumber = arraypop(bbcode) - 1;
				txtarea.value += bbtags[butnumber + 1];
				buttext = eval('document.post.addbbcode' + butnumber + '.value');
				eval('document.post.addbbcode' + butnumber + '.value ="' + buttext.substr(0,(buttext.length - 1)) + '"');
				imageTag = false;
			}
			txtarea.focus();
			return;
	} else { // Open tags
	
		if (imageTag && (bbnumber != 14)) {		// Close image tag before adding another
			txtarea.value += bbtags[15];
			lastValue = arraypop(bbcode) - 1;	// Remove the close image tag from the list
			document.post.addbbcode14.value = "Img";	// Return button back to normal state
			imageTag = false;
		}
		
		// Open tag
		txtarea.value += bbtags[bbnumber];
		if ((bbnumber == 14) && (imageTag == false)) imageTag = 1; // Check to stop additional tags after an unclosed image tag
		arraypush(bbcode,bbnumber+1);
		eval('document.post.addbbcode'+bbnumber+'.value += "*"');
		txtarea.focus();
		return;
	}
	storeCaret(txtarea);
}

// From http://www.massless.org/mozedit/
function mozWrap(txtarea, open, close)
{
	var selLength = txtarea.textLength;
	var selStart = txtarea.selectionStart;
	var selEnd = txtarea.selectionEnd;
	if (selEnd == 1 || selEnd == 2) 
		selEnd = selLength;

	var s1 = (txtarea.value).substring(0,selStart);
	var s2 = (txtarea.value).substring(selStart, selEnd)
	var s3 = (txtarea.value).substring(selEnd, selLength);
	txtarea.value = s1 + open + s2 + close + s3;
	return;
}

// Insert at Claret position. Code from
// http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130
function storeCaret(textEl) {
	if (textEl.createTextRange) textEl.caretPos = document.selection.createRange().duplicate();
}

//-->
</script>

<!-- BEGIN privmsg_extensions -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
# *snip*
#
<!-- BEGIN privmsg_extensions -->
#
#-----[ FIND ]------------------------------------------------
#
<!-- END privmsg_extensions -->

<!-- BEGIN switch_standalone -->
#
#-----[ AFTER, ADD ]------------------------------------------
#
<!-- INCLUDE posting_bbcode.tpl -->
#
#-----[ FIND ]------------------------------------------------
#
		<a class="maintitle" href="{U_TITLE}">{TITLE}</a>
	</span><span class="gensmall"><br />
		<!-- BEGIN moderators -->
		<b>{L_MODERATORS}:&nbsp;</b>
		<!-- BEGIN mod -->
		<a href="{moderators.mod.U_MOD}" title="{moderators.mod.L_MOD_TITLE}" class="gensmall">{moderators.mod.L_MOD}</a>{moderators.mod.L_SEP}
		<!-- END mod -->
		<!-- END moderators -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<a class="maintitle" href="{U_TITLE}">{TITLE}</a>
#
#-----[ FIND ]------------------------------------------------
#
				  <td colspan="{S_SMILIES_COLSPAN}"><span  class="nav"><a href="{U_MORE_SMILIES}" onclick="window.open('{U_MORE_SMILIES}', '_phpbbsmilies', 'HEIGHT=300,resizable=yes,scrollbars=yes,WIDTH=250');return false;" target="_phpbbsmilies" class="nav">{L_MORE_SMILIES}</a></span></td>
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<span  class="nav">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<span class="topictitle">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
class="nav"
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
class="topictitle"
#
#-----[ FIND ]------------------------------------------------
#
	  <td class="row2" valign="top"><span class="gen"> <span class="genmed"> </span>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td class="row2" valign="top">
#
#-----[ FIND ]------------------------------------------------
#
		</span></td>
	</tr>
	<tr> 
	  <td class="row1" valign="top"><span class="gen"><b>{L_OPTIONS}</b></span><br /><span class="gensmall">{HTML_STATUS}<br />{BBCODE_STATUS}<br />{SMILIES_STATUS}</span></td>
	  <td class="row2"><span class="gen"> </span> 
#
#-----[ REPLACE WITH ]----------------------------------------
#
		</td>
	</tr>
	<tr> 
	  <td class="row1" valign="top"><span class="gen"><b>{L_OPTIONS}</b></span><br /><span class="gensmall">{HTML_STATUS}<br />{BBCODE_STATUS}<br />{SMILIES_STATUS}</span></td>
	  <td class="row2">
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" border="0" align="center">
<tr>
	<td nowrap="nowrap" align="right"><span class="gensmall">{JUMPBOX}</span></td>
</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table width="100%" cellspacing="2" border="0" align="center">
  <tr> 
	<td nowrap="nowrap" align="right">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/posting_preview.tpl
#
#-----[ FIND ]------------------------------------------------
#
		<td class="row1"><img src="templates/subSilver/images/icon_minipost.gif" alt="{L_POST}" /><span class="postdetails">{L_POSTED}: {POST_DATE} &nbsp;&nbsp;&nbsp; {L_POST_SUBJECT}:
			<!-- BEGIN msg_icon -->
			<img src="{msg_icon.I_ICON}" border="0" title="{msg_icon.L_ICON}" align="absbottom" />
			<!-- END msg_icon -->
			{POST_SUBJECT}
			<!-- BEGIN sub_title -->
			<br />{L_SUB_TITLE}: {sub_title.SUB_TITLE}
			<!-- END sub_title -->
			<!-- BEGIN announce -->
			<br />{announce.S_ANNOUNCE}
			<!-- END announce -->
			<!-- BEGIN calendar_event -->
			<br />{calendar_event.S_CALENDAR_EVENT}
			<!-- END calendar_event -->
		</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td class="row1"><img src="{I_POST}" alt="{L_POST}" /><span class="postdetails">{L_POSTED}: {POST_DATE} &nbsp;&nbsp;&nbsp; {L_POST_SUBJECT}:
			<!-- BEGIN msg_icon --><img src="{msg_icon.I_ICON}" border="0" title="{msg_icon.L_ICON}" class="absbottom" />&nbsp;<!-- END msg_icon -->
			<!-- BEGIN sub_type --><!-- BEGIN img --><img src="{sub_type.I_SUB_TYPE}" border="0" alt="{sub_type.L_SUB_TYPE}" title="{sub_type.L_SUB_TYPE}" class="absbottom" />&nbsp;<!-- END img --><!-- BEGIN txt --><b>[{sub_type.L_SUB_TYPE}]</b>&nbsp;<!-- END txt --><!-- END sub_type -->
			{POST_SUBJECT}
			<!-- BEGIN sub_title --><br />{L_SUB_TITLE}: {sub_title.SUB_TITLE}<!-- END sub_title -->
			<!-- BEGIN announce --><br />{announce.S_ANNOUNCE}<!-- END announce -->
			<!-- BEGIN calendar_event --><br />{calendar_event.S_CALENDAR_EVENT}<!-- END calendar_event -->
		</span></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/posting_topic_review.tpl
#
#-----[ FIND ]------------------------------------------------
#
<!-- END switch_inline_mode -->
#
#-----[ AFTER, ADD ]------------------------------------------
#

<!-- BEGIN pagination -->
<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr>
	<td width="100%" valign="bottom"><span class="gensmall">
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
	</span></td>
	<td align="right" valign="bottom" nowrap="nowrap"><span class="gensmall">&nbsp;
		<!-- BEGIN unique_ELSE --><b>{pagination.L_GOTO}:&nbsp;</b><!-- END unique_ELSE -->
		<!-- BEGIN previous --><b><a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;</b><!-- END previous -->
		<!-- BEGIN page_number --><b><!-- BEGIN number --><!-- BEGIN current_ELSE --><a href="{pagination.page_number.U_PAGE}" class="gensmall"><!-- END current_ELSE -->{pagination.page_number.PAGE}<!-- BEGIN current_ELSE --></a><!-- END current_ELSE --><!-- BEGIN sep -->, <!-- END sep --><!-- BEGINELSE number -->..., <!-- END number --></b><!-- END page_number -->
		<!-- BEGIN next --><b>&nbsp;<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a></b><!-- END next -->
	</span></td>
</tr>
</table>
<!-- END pagination -->
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
<a name="{postrow.U_POST_ID}"></a>
#
#----------[ IN-LINE FIND ]-----------------------------------
#
><a name="{postrow.U_POST_ID}"></a>
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
>
#
#-----[ FIND ]------------------------------------------------
#
					<!-- BEGIN msg_icon -->
					<img src="{postrow.msg_icon.I_ICON}" border="0" title="{postrow.msg_icon.L_ICON}" align="absbottom" />
					<!-- END msg_icon -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
					<!-- BEGIN msg_icon --><img src="{postrow.msg_icon.I_ICON}" border="0" title="{postrow.msg_icon.L_ICON}" class="absbottom" />&nbsp;<!-- END msg_icon -->
					<!-- BEGIN sub_type --><!-- BEGIN img --><img src="{postrow.sub_type.I_SUB_TYPE}" border="0" alt="{postrow.sub_type.L_SUB_TYPE}" title="{postrow.sub_type.L_SUB_TYPE}" class="absbottom" />&nbsp;<!-- END img --><!-- BEGIN txt --><b>[{postrow.sub_type.L_SUB_TYPE}]</b>&nbsp;<!-- END txt --><!-- END sub_type -->
#
#-----[ FIND ]------------------------------------------------
#
					<!-- BEGIN sub_title -->
					<br />{L_SUB_TITLE}: {postrow.sub_title.SUB_TITLE}
					<!-- END sub_title -->
					<!-- BEGIN announce -->
					<br />{postrow.announce.S_ANNOUNCE}
					<!-- END announce -->
					<!-- BEGIN calendar_event -->
					<br />{postrow.calendar_event.S_CALENDAR_EVENT}
					<!-- END calendar_event -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
					<!-- BEGIN sub_title --><br />{L_SUB_TITLE}: {postrow.sub_title.SUB_TITLE}<!-- END sub_title -->
					<!-- BEGIN announce --><br />{postrow.announce.S_ANNOUNCE}<!-- END announce -->
					<!-- BEGIN calendar_event --><br />{postrow.calendar_event.S_CALENDAR_EVENT}<!-- END calendar_event -->
#
#-----[ FIND ]------------------------------------------------
#
<!-- BEGIN switch_inline_mode -->
#
#-----[ BEFORE, ADD ]-----------------------------------------
#

<!-- BEGIN pagination -->
<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr>
	<td width="100%" valign="top"><span class="gensmall">
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
	</span></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">&nbsp;
		<!-- BEGIN unique_ELSE --><b>{pagination.L_GOTO}:&nbsp;</b><!-- END unique_ELSE -->
		<!-- BEGIN previous --><b><a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;</b><!-- END previous -->
		<!-- BEGIN page_number --><b><!-- BEGIN number --><!-- BEGIN current_ELSE --><a href="{pagination.page_number.U_PAGE}" class="gensmall"><!-- END current_ELSE -->{pagination.page_number.PAGE}<!-- BEGIN current_ELSE --></a><!-- END current_ELSE --><!-- BEGIN sep -->, <!-- END sep --><!-- BEGINELSE number -->..., <!-- END number --></b><!-- END page_number -->
		<!-- BEGIN next --><b>&nbsp;<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a></b><!-- END next -->
	</span></td>
</tr>
</table>
<!-- END pagination -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/search_results_posts.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr>
	<td width="100%" valign="bottom"><span class="gensmall">
		<!-- BEGIN pagination -->
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
		<!-- END pagination -->
	</span></td>
	<td align="right" valign="bottom" nowrap="nowrap"><span class="gensmall">
		<b>
		<!-- BEGIN pagination -->
		<!-- BEGIN unique_ELSE -->
		{pagination.L_GOTO}:&nbsp;
		<!-- END unique_ELSE -->
		<!-- BEGIN previous -->
		<a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;
		<!-- END previous -->

		<!-- BEGIN page_number -->
		<!-- BEGIN number -->
		<!-- BEGIN current -->
		{pagination.page_number.PAGE}{pagination.page_number.L_SEP}
		<!-- END current -->
		<!-- BEGIN current_ELSE -->
		<a href="{pagination.page_number.U_PAGE}" class="gensmall">{pagination.page_number.PAGE}</a>{pagination.page_number.L_SEP}
		<!-- END current_ELSE -->
		<!-- END number -->
		<!-- BEGIN number_ELSE -->
		...,
		<!-- END number_ELSE -->
		<!-- END page_number -->

		<!-- BEGIN next -->
		<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a>
		<!-- END next -->
		<!-- END pagination -->
	</b></span></td>
</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- BEGIN pagination -->
<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr>
	<td width="100%" valign="bottom"><span class="gensmall">
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
	</span></td>
	<td align="right" valign="bottom" nowrap="nowrap"><span class="gensmall">&nbsp;
		<!-- BEGIN unique_ELSE --><b>{pagination.L_GOTO}:&nbsp;</b><!-- END unique_ELSE -->
		<!-- BEGIN previous --><b><a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;</b><!-- END previous -->
		<!-- BEGIN page_number --><b><!-- BEGIN number --><!-- BEGIN current_ELSE --><a href="{pagination.page_number.U_PAGE}" class="gensmall"><!-- END current_ELSE -->{pagination.page_number.PAGE}<!-- BEGIN current_ELSE --></a><!-- END current_ELSE --><!-- BEGIN sep -->, <!-- END sep --><!-- BEGINELSE number -->..., <!-- END number --></b><!-- END page_number -->
		<!-- BEGIN next --><b>&nbsp;<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a></b><!-- END next -->
	</span></td>
</tr>
</table>
<!-- END pagination -->
#
#-----[ FIND ]------------------------------------------------
#
		<!-- BEGIN msg_icon -->
		<img src="{searchresults.msg_icon.I_ICON}" border="0" title="{searchresults.msg_icon.L_ICON}" align="absbottom" />
		<!-- END msg_icon -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<!-- BEGIN msg_icon --><img src="{searchresults.msg_icon.I_ICON}" border="0" title="{searchresults.msg_icon.L_ICON}" class="absbottom" />&nbsp;<!-- END msg_icon -->
		<!-- BEGIN sub_type --><!-- BEGIN img --><img src="{searchresults.sub_type.I_SUB_TYPE}" border="0" alt="{searchresults.sub_type.L_SUB_TYPE}" title="{searchresults.sub_type.L_SUB_TYPE}" class="absbottom" />&nbsp;<!-- END img --><!-- BEGIN txt --><b>[{searchresults.sub_type.L_SUB_TYPE}]</b>&nbsp;<!-- END txt --><!-- END sub_type -->
#
#-----[ FIND ]------------------------------------------------
#
		<!-- BEGIN sub_title -->
		<br />{L_SUB_TITLE}: {searchresults.sub_title.SUB_TITLE}
		<!-- END sub_title -->
		<!-- BEGIN announce -->
		<br />{searchresults.announce.S_ANNOUNCE}
		<!-- END announce -->
		<!-- BEGIN calendar_event -->
		<br />{searchresults.calendar_event.S_CALENDAR_EVENT}
		<!-- END calendar_event -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<!-- BEGIN sub_title --><br />{L_SUB_TITLE}: {searchresults.sub_title.SUB_TITLE}<!-- END sub_title -->
		<!-- BEGIN announce --><br />{searchresults.announce.S_ANNOUNCE}<!-- END announce -->
		<!-- BEGIN calendar_event --><br />{searchresults.calendar_event.S_CALENDAR_EVENT}<!-- END calendar_event -->
#
#-----[ FIND ]------------------------------------------------
#
		<!-- BEGIN nav -->
		<a href="{searchresults.nav.U_NAV}" title="{searchresults.nav.L_NAV_DESC}" class="postdetails">{searchresults.nav.L_NAV}</a>
		<!-- BEGIN sep -->
		&raquo;
		<!-- END sep -->
		<!-- END nav -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<!-- BEGIN nav --><a href="{searchresults.nav.U_NAV}" title="{searchresults.nav.L_NAV_DESC}" class="postdetails">{searchresults.nav.L_NAV}</a><!-- BEGIN sep --> &raquo;&nbsp;<!-- END sep --><!-- END nav -->
#
#-----[ FIND ]------------------------------------------------
#

<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr>
	<td width="100%" valign="top"><span class="gensmall">
		<!-- BEGIN pagination -->
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
		<!-- END pagination -->
	</span></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">
		<b>
		<!-- BEGIN pagination -->
		<!-- BEGIN unique_ELSE -->
		{pagination.L_GOTO}:&nbsp;
		<!-- END unique_ELSE -->
		<!-- BEGIN previous -->
		<a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;
		<!-- END previous -->

		<!-- BEGIN page_number -->
		<!-- BEGIN number -->
		<!-- BEGIN current -->
		{pagination.page_number.PAGE}{pagination.page_number.L_SEP}
		<!-- END current -->
		<!-- BEGIN current_ELSE -->
		<a href="{pagination.page_number.U_PAGE}" class="gensmall">{pagination.page_number.PAGE}</a>{pagination.page_number.L_SEP}
		<!-- END current_ELSE -->
		<!-- END number -->
		<!-- BEGIN number_ELSE -->
		...,
		<!-- END number_ELSE -->
		<!-- END page_number -->

		<!-- BEGIN next -->
		<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a>
		<!-- END next -->
		<!-- END pagination -->
	</b></span></td>
</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- BEGIN pagination -->
<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr>
	<td width="100%" valign="top"><span class="gensmall">
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
	</span></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">&nbsp;
		<!-- BEGIN unique_ELSE --><b>{pagination.L_GOTO}:&nbsp;</b><!-- END unique_ELSE -->
		<!-- BEGIN previous --><b><a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;</b><!-- END previous -->
		<!-- BEGIN page_number --><b><!-- BEGIN number --><!-- BEGIN current_ELSE --><a href="{pagination.page_number.U_PAGE}" class="gensmall"><!-- END current_ELSE -->{pagination.page_number.PAGE}<!-- BEGIN current_ELSE --></a><!-- END current_ELSE --><!-- BEGIN sep -->, <!-- END sep --><!-- BEGINELSE number -->..., <!-- END number --></b><!-- END page_number -->
		<!-- BEGIN next --><b>&nbsp;<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a></b><!-- END next -->
	</span></td>
</tr>
</table>
<!-- END pagination -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/simple_footer.tpl
#
#-----[ FIND ]------------------------------------------------
#
		</td>
	</tr>
</table>

</body>
</html>
#
#-----[ REPLACE WITH ]----------------------------------------
#

</body>
</html>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/simple_header.tpl
#
#-----[ FIND ]------------------------------------------------
#
<style type="text/css">
<!--
#
#-----[ AFTER, ADD ]------------------------------------------
#

.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/subSilver.cfg
#
#-----[ FIND ]------------------------------------------------
#
// images addition
#
#-----[ REPLACE WITH ]----------------------------------------
#
// vote bars sides
$images['voting_left'][0] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][1] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][2] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][3] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][4] = "$current_template_images/vote_lcap.gif";
$images['voting_right'][0] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][1] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][2] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][3] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][4] = "$current_template_images/vote_rcap.gif";

// page header
$images['logo'] = "$current_template_images/logo_phpBB.gif";
$images['logo_small'] = "$current_template_images/logo_phpBB_med.gif";
$images['earth'] = $current_template_images . '/earth.gif';

// menu
$images['menu_admin'] = "";
$images['menu_faq'] = "";
$images['menu_search'] = "";
$images['menu_memberlist'] = "";
$images['menu_usergroup'] = "";
$images['menu_register'] = "";
$images['menu_profile'] = "";
$images['menu_preferences'] = "";
$images['pm_new_msg'] =  "";
$images['pm_no_new_msg'] =  "";
$images['menu_login'] =  "";
$images['menu_logout'] =  "";

// various pics
$images['forum_mark_read'] = "";
$images['topic_mark_read'] = "";
$images['topic_unmark_read'] = "";
$images['topic_previous'] = "";
$images['topic_next'] = "";
$images['icon_go_top'] = "";

// index page
#
#-----[ FIND ]------------------------------------------------
#
$images['topic_locked_tiny'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#
$images['topic_poll_tiny'] = "$current_template_images/topic_poll_tiny.gif";
$images['topic_calendar_tiny'] = "$current_template_images/topic_calendar_tiny.gif";
#
#-----[ FIND ]------------------------------------------------
#
$images['folder_sticky_new_own'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#

$images['folder_moved'] = "$current_template_images/folder_moved.gif";
#
#-----[ FIND ]------------------------------------------------
#
$images['folder_hot_new_own'] =
#
#-----[ AFTER, ADD ]------------------------------------------
#

$images['folder_calendar'] = "$current_template_images/folder_calendar.gif";
$images['folder_calendar_new'] = "$current_template_images/folder_calendar_new.gif";
$images['folder_calendar_new_own'] = "$current_template_images/folder_calendar_new_own.gif";
$images['folder_calendar_own'] = "$current_template_images/folder_calendar_own.gif";
#
#-----[ FIND ]------------------------------------------------
#
$images['spacer'] = "$current_template_images/spacer.gif";
#
#-----[ AFTER, ADD ]------------------------------------------
#

// calendar
$images['folder_birthday'] = "$current_template_images/folder_calendar.gif";

$images['icon_calendar'] = "$current_template_images/icon_calendar.gif";
$images['menu_calendar'] = "$current_template_images/icon_mini_calendar.gif";
$images['icon_tiny_topic'] = "$current_template_images/icon_tiny_topic.gif";
$images['icon_tiny_profile'] = "$current_template_images/icon_tiny_profile.gif";
$images['up_arrow'] = "$current_template_images/icon_up_arrow.gif";
$images['down_arrow'] = "$current_template_images/icon_down_arrow.gif";
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/subSilver.css
#
#-----[ FIND ]------------------------------------------------
#
/*
  The original subSilver Theme for phpBB version 2+
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/viewtopic_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="0" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left" valign="bottom"><span class="gensmall">
	<!-- BEGIN switch_user_logged_in -->
	{LAST_VISIT_DATE}<br />
	<!-- END switch_user_logged_in -->
	{CURRENT_TIME}<br />
	{S_TIMEZONE}
	</span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table width="100%" cellspacing="0" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left" valign="bottom"><span class="gensmall">
	<!-- BEGIN switch_user_logged_in -->{LAST_VISIT_DATE}<br /><!-- END switch_user_logged_in -->
	{CURRENT_TIME}<br />
	{S_TIMEZONE}
	</span></td>
  </tr>
</table>
#
#-----[ FIND ]------------------------------------------------
#
		<!-- BEGIN moderators -->
		<b>{L_MODERATORS}:&nbsp;</b>
		<!-- BEGIN mod -->
		<a href="{moderators.mod.U_MOD}" title="{moderators.mod.L_MOD_TITLE}" class="gensmall">{moderators.mod.L_MOD}</a>{moderators.mod.L_SEP}
		<!-- END mod -->
		<!-- END moderators -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<!-- BEGIN moderators --><b>{L_MODERATORS}:&nbsp;</b><!-- BEGIN mod --><a href="{moderators.mod.U_MOD}" title="{moderators.mod.L_MOD_TITLE}" class="gensmall">{moderators.mod.L_MOD}</a><!-- BEGIN sep -->, <!-- END sep --><!-- END mod --><!-- END moderators -->
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0">
<tr>
	<td align="left" nowrap="nowrap"><span class="nav"><a href="{U_POST_NEW_TOPIC}"><img src="{POST_IMG}" border="0" alt="{L_POST_NEW_TOPIC}" align="middle" /></a>&nbsp;&nbsp;&nbsp;<a href="{U_POST_REPLY_TOPIC}"><img src="{REPLY_IMG}" border="0" alt="{L_POST_REPLY_TOPIC}" align="middle" /></a></span></td>
	<td width="100%" valign="bottom"><span class="gensmall">
		<!-- BEGIN pagination -->
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
		<!-- END pagination -->
	</span></td>
	<td align="right" valign="bottom" nowrap="nowrap"><span class="gensmall">
		<!-- BEGIN watch -->
		<!-- BEGIN image -->
		<a href="{U_WATCH_TOPIC}" class="gensmall"><img src="{I_WATCH_TOPIC}" border="0" title="{L_WATCH_TOPIC}" alt="{L_WATCH_TOPIC}" /></a>
		<!-- END image -->
		<!-- BEGIN image_ELSE -->
		<a href="{U_WATCH_TOPIC}" class="gensmall">{L_WATCH_TOPIC}</a>
		<!-- END image_ELSE -->
		<br />
		<!-- END watch -->
		<!-- BEGIN unmark_read -->
		<a href="{U_UNREAD_TOPIC}" class="gensmall">{L_UNREAD_TOPIC}</a> ::
		<!-- END unmark_read -->
		<a href="{U_VIEW_OLDER_TOPIC}" class="gensmall">{L_VIEW_PREVIOUS_TOPIC}</a> :: <a href="{U_VIEW_NEWER_TOPIC}" class="gensmall">{L_VIEW_NEXT_TOPIC}</a><br/>
		<b>
		<!-- BEGIN pagination -->
		<!-- BEGIN unique_ELSE -->
		{pagination.L_GOTO}:&nbsp;
		<!-- END unique_ELSE -->
		<!-- BEGIN previous -->
		<a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;
		<!-- END previous -->

		<!-- BEGIN page_number -->
		<!-- BEGIN number -->
		<!-- BEGIN current -->
		{pagination.page_number.PAGE}{pagination.page_number.L_SEP}
		<!-- END current -->
		<!-- BEGIN current_ELSE -->
		<a href="{pagination.page_number.U_PAGE}" class="gensmall">{pagination.page_number.PAGE}</a>{pagination.page_number.L_SEP}
		<!-- END current_ELSE -->
		<!-- END number -->
		<!-- BEGIN number_ELSE -->
		...,
		<!-- END number_ELSE -->
		<!-- END page_number -->

		<!-- BEGIN next -->
		<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a>
		<!-- END next -->
		<!-- END pagination -->
	</b></span></td>
</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0">
<tr>
	<td align="left" valign="bottom" nowrap="nowrap"><span class="nav">
		<a href="{U_POST_NEW_TOPIC}"><img src="{POST_IMG}" border="0" alt="{L_POST_NEW_TOPIC}" align="middle" /></a>&nbsp;&nbsp;&nbsp;<a href="{U_POST_REPLY_TOPIC}"><img src="{REPLY_IMG}" border="0" alt="{L_POST_REPLY_TOPIC}" align="middle" /></a>
	</span></td>
	<td width="100%" valign="bottom"><span class="gensmall">
		<!-- BEGIN pagination --><b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}<!-- END pagination -->
	</span></td>
	<td align="right" valign="bottom" nowrap="nowrap"><span class="gensmall">
		<!-- BEGIN watch --><a href="{U_WATCH_TOPIC}" class="gensmall"><!-- BEGIN image --><img src="{I_WATCH_TOPIC}" border="0" title="{L_WATCH_TOPIC}" alt="{L_WATCH_TOPIC}" /><!-- BEGINELSE image -->{L_WATCH_TOPIC}<!-- END image --></a><br /><!-- END watch -->
		<!-- BEGIN unmark_read --><a href="{U_UNREAD_TOPIC}" class="gensmall">{L_UNREAD_TOPIC}</a>&nbsp;::&nbsp;<!-- END unmark_read -->
		<a href="{U_VIEW_OLDER_TOPIC}" class="gensmall">{L_VIEW_PREVIOUS_TOPIC}</a> :: <a href="{U_VIEW_NEWER_TOPIC}" class="gensmall">{L_VIEW_NEXT_TOPIC}</a><br />
<!-- BEGIN pagination -->
		<!-- BEGIN unique_ELSE --><b>{pagination.L_GOTO}:&nbsp;</b><!-- END unique_ELSE -->
		<!-- BEGIN previous --><b><a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;</b><!-- END previous -->
		<!-- BEGIN page_number --><b><!-- BEGIN number --><!-- BEGIN current_ELSE --><a href="{pagination.page_number.U_PAGE}" class="gensmall"><!-- END current_ELSE -->{pagination.page_number.PAGE}<!-- BEGIN current_ELSE --></a><!-- END current_ELSE --><!-- BEGIN sep -->, <!-- END sep --><!-- BEGINELSE number -->..., <!-- END number --></b><!-- END page_number -->
		<!-- BEGIN next --><b>&nbsp;<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a></b><!-- END next -->
<!-- END pagination -->
	</span></td>
</tr>
</table>
#
#-----[ FIND ]------------------------------------------------
#
		<td width="150" align="left" valign="top" class="{postrow.ROW_CLASS}"><span class="name"><a name="{postrow.U_POST_ID}"></a><b>{postrow.POSTER_NAME}</b></span><br /><span class="postdetails">{postrow.POSTER_RANK}<br />{postrow.RANK_IMAGE}{postrow.POSTER_AVATAR}<br /><br />{postrow.POSTER_JOINED}<br />{postrow.POSTER_POSTS}<br />{postrow.POSTER_FROM}</span><br /></td>
		<td class="{postrow.ROW_CLASS}" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td width="150" align="left" valign="top" class="<!-- BEGIN light -->row1<!-- BEGINELSE light -->row2<!-- END light -->"><span class="name">
			<a name="{postrow.U_POST_ID}"></a><b>{postrow.POSTER_NAME}</b>
		</span><br /><span class="postdetails">
			{postrow.POSTER_RANK}<br />{postrow.RANK_IMAGE}{postrow.POSTER_AVATAR}<br /><br />{postrow.POSTER_JOINED}<br />{postrow.POSTER_POSTS}<br />{postrow.POSTER_FROM}
		</span><br /></td>
		<td class="<!-- BEGIN light -->row1<!-- BEGINELSE light -->row2<!-- END light -->" width="100%" height="28" valign="top">
			<table width="100%" border="0" cellspacing="0" cellpadding="0">
#
#-----[ FIND ]------------------------------------------------
#
					<!-- BEGIN msg_icon -->
					<img src="{postrow.msg_icon.I_ICON}" border="0" title="{postrow.msg_icon.L_ICON}" align="absbottom" />
					<!-- END msg_icon -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
					<!-- BEGIN msg_icon --><img src="{postrow.msg_icon.I_ICON}" border="0" title="{postrow.msg_icon.L_ICON}" class="absbottom" />&nbsp;<!-- END msg_icon -->
					<!-- BEGIN sub_type --><!-- BEGIN img --><img src="{postrow.sub_type.I_SUB_TYPE}" border="0" alt="{postrow.sub_type.L_SUB_TYPE}" title="{postrow.sub_type.L_SUB_TYPE}" class="absbottom" /><!-- END img --><!-- BEGIN txt --><b>[{postrow.sub_type.L_SUB_TYPE}]</b><!-- END txt -->&nbsp;<!-- END sub_type -->
#
#-----[ FIND ]------------------------------------------------
#
					<!-- BEGIN sub_title -->
					<br />{L_SUB_TITLE}: {postrow.sub_title.SUB_TITLE}
					<!-- END sub_title -->
					<!-- BEGIN announce -->
					<br />{postrow.announce.S_ANNOUNCE}
					<!-- END announce -->
					<!-- BEGIN calendar_event -->
					<br />{postrow.calendar_event.S_CALENDAR_EVENT}
					<!-- END calendar_event -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
					<!-- BEGIN sub_title --><br />{L_SUB_TITLE}: {postrow.sub_title.SUB_TITLE}<!-- END sub_title -->
					<!-- BEGIN announce --><br />{postrow.announce.S_ANNOUNCE}<!-- END announce -->
					<!-- BEGIN calendar_event --><br />{postrow.calendar_event.S_CALENDAR_EVENT}<!-- END calendar_event -->
#
#-----[ FIND ]------------------------------------------------
#
				<td valign="top" nowrap="nowrap">{postrow.QUOTE_IMG} {postrow.EDIT_IMG} {postrow.DELETE_IMG} {postrow.IP_IMG}
				<!-- BEGIN unmark_read -->
				<a href="{postrow.U_UNREAD_POST}" class="gensmall"><img src="{I_UNREAD}" border="0" alt="{L_UNREAD_POST}" title="{L_UNREAD_POST}" /></a>
				<!-- END unmark_read -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
				<td valign="top" nowrap="nowrap">{postrow.QUOTE_IMG} {postrow.EDIT_IMG} {postrow.DELETE_IMG} {postrow.IP_IMG}<!-- BEGIN unmark_read -->&nbsp;<a href="{postrow.U_UNREAD_POST}" class="gensmall"><img src="{I_UNREAD}" border="0" alt="{L_UNREAD_POST}" title="{L_UNREAD_POST}" /></a><!-- END unmark_read -->
#
#-----[ FIND ]------------------------------------------------
#
		<td class="{postrow.ROW_CLASS}" width="150" align="left" valign="middle"><span class="nav"><a href="#top" class="nav">{L_BACK_TO_TOP}</a></span></td>
		<td class="{postrow.ROW_CLASS}" width="100%" height="28" valign="bottom" nowrap="nowrap"><table cellspacing="0" cellpadding="0" border="0" height="18" width="18">
			<tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td class="<!-- BEGIN light -->row1<!-- BEGINELSE light -->row2<!-- END light -->" width="150" align="left" valign="middle"><span class="nav">
			<a href="#top" class="nav">{L_BACK_TO_TOP}</a>
		</span></td>
		<td class="<!-- BEGIN light -->row1<!-- BEGINELSE light -->row2<!-- END light -->" width="100%" height="28" valign="bottom" nowrap="nowrap">
			<table cellspacing="0" cellpadding="0" border="0" style="height: 18px" width="18">
			<tr>
#
#-----[ FIND ]------------------------------------------------
#
	<tr align="center"> 
		<td class="catBottom" colspan="2" height="28"><table cellspacing="0" cellpadding="0" border="0">
			<tr><form method="post" action="{S_POST_DAYS_ACTION}">
				<td align="center"><span class="gensmall">{L_DISPLAY_POSTS}: {S_SELECT_POST_DAYS}&nbsp;{S_SELECT_POST_ORDER}&nbsp;<input type="submit" value="{L_GO}" class="liteoption" name="submit" /></span></td>
			</form></tr>
		</table></td>
	</tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<tr align="center"> 
		<td class="catBottom" colspan="2" height="28"><table cellspacing="0" cellpadding="0" border="0">
			<tr>
				<td align="center"><form method="post" action="{S_POST_DAYS_ACTION}"><span class="gensmall">{L_DISPLAY_POSTS}: {S_SELECT_POST_DAYS}&nbsp;{S_SELECT_POST_ORDER}&nbsp;<input type="submit" value="{L_GO}" class="liteoption" name="submit" /></span></form></td>
			</tr>
		</table></td>
	</tr>
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0">
<tr>
	<td align="left" nowrap="nowrap"><span class="nav"><a href="{U_POST_NEW_TOPIC}"><img src="{POST_IMG}" border="0" alt="{L_POST_NEW_TOPIC}" align="middle" /></a>&nbsp;&nbsp;&nbsp;<a href="{U_POST_REPLY_TOPIC}"><img src="{REPLY_IMG}" border="0" alt="{L_POST_REPLY_TOPIC}" align="middle" /></a></span></td>
	<td width="100%" valign="top"><span class="gensmall">
		<!-- BEGIN pagination -->
		<b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}
		<!-- END pagination -->
	</span></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall"><b>
		<!-- BEGIN pagination -->
		<!-- BEGIN unique_ELSE -->
		{pagination.L_GOTO}:&nbsp;
		<!-- END unique_ELSE -->
		<!-- BEGIN previous -->
		<a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;
		<!-- END previous -->

		<!-- BEGIN page_number -->
		<!-- BEGIN number -->
		<!-- BEGIN current -->
		{pagination.page_number.PAGE}{pagination.page_number.L_SEP}
		<!-- END current -->
		<!-- BEGIN current_ELSE -->
		<a href="{pagination.page_number.U_PAGE}" class="gensmall">{pagination.page_number.PAGE}</a>{pagination.page_number.L_SEP}
		<!-- END current_ELSE -->
		<!-- END number -->
		<!-- BEGIN number_ELSE -->
		...,
		<!-- END number_ELSE -->
		<!-- END page_number -->

		<!-- BEGIN next -->
		<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a>
		<!-- END next -->
		<!-- BEGIN unique_ELSE -->
		<br />
		<!-- END unique_ELSE -->
		<!-- END pagination -->
		</b><a href="{U_VIEW_OLDER_TOPIC}" class="gensmall">{L_VIEW_PREVIOUS_TOPIC}</a> :: <a href="{U_VIEW_NEWER_TOPIC}" class="gensmall">{L_VIEW_NEXT_TOPIC}</a><br/>
		<!-- BEGIN watch -->
		<!-- BEGIN image -->
		<a href="{U_WATCH_TOPIC}" class="gensmall"><img src="{I_WATCH_TOPIC}" border="0" title="{L_WATCH_TOPIC}" alt="{L_WATCH_TOPIC}" /></a>
		<!-- END image -->
		<!-- BEGIN image_ELSE -->
		<a href="{U_WATCH_TOPIC}" class="gensmall">{L_WATCH_TOPIC}</a>
		<!-- END image_ELSE -->
		<!-- END watch -->
	</span></td>
</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0">
<tr>
	<td align="left" valign="top" nowrap="nowrap"><span class="nav">
		<a href="{U_POST_NEW_TOPIC}"><img src="{POST_IMG}" border="0" alt="{L_POST_NEW_TOPIC}" align="middle" /></a>&nbsp;&nbsp;&nbsp;<a href="{U_POST_REPLY_TOPIC}"><img src="{REPLY_IMG}" border="0" alt="{L_POST_REPLY_TOPIC}" align="middle" /></a>
	</span></td>
	<td width="100%" valign="top"><span class="gensmall">
		<!-- BEGIN pagination --><b>{pagination.L_PAGE_OF}</b>&nbsp;{pagination.L_COUNT}<!-- END pagination -->
	</span></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">
<!-- BEGIN pagination -->
		<!-- BEGIN unique_ELSE --><b>{pagination.L_GOTO}:&nbsp;</b><!-- END unique_ELSE -->
		<!-- BEGIN previous --><b><a href="{pagination.U_PREVIOUS}" class="gensmall">{pagination.L_PREVIOUS}</a>&nbsp;</b><!-- END previous -->
		<!-- BEGIN page_number --><b><!-- BEGIN number --><!-- BEGIN current_ELSE --><a href="{pagination.page_number.U_PAGE}" class="gensmall"><!-- END current_ELSE -->{pagination.page_number.PAGE}<!-- BEGIN current_ELSE --></a><!-- END current_ELSE --><!-- BEGIN sep -->, <!-- END sep --><!-- BEGINELSE number -->..., <!-- END number --></b><!-- END page_number -->
		<!-- BEGIN next --><b>&nbsp;<a href="{pagination.U_NEXT}" class="gensmall">{pagination.L_NEXT}</a></b><!-- END next -->
		<!-- BEGIN unique_ELSE --><br /><!-- END unique_ELSE -->
<!-- END pagination -->
		<!-- BEGIN unmark_read --><a href="{U_UNREAD_TOPIC}" class="gensmall">{L_UNREAD_TOPIC}</a>&nbsp;::&nbsp;<!-- END unmark_read -->
		<a href="{U_VIEW_OLDER_TOPIC}" class="gensmall">{L_VIEW_PREVIOUS_TOPIC}</a> :: <a href="{U_VIEW_NEWER_TOPIC}" class="gensmall">{L_VIEW_NEXT_TOPIC}</a><br />
		<!-- BEGIN watch --><a href="{U_WATCH_TOPIC}" class="gensmall"><!-- BEGIN image --><img src="{I_WATCH_TOPIC}" border="0" title="{L_WATCH_TOPIC}" alt="{L_WATCH_TOPIC}" /><!-- BEGINELSE image -->{L_WATCH_TOPIC}<!-- END image --></a><!-- END watch -->
	</span></td>
</tr>
</table>
#
#-----[ FIND ]------------------------------------------------
#
			<td nowrap="nowrap" align="right"><span class="gensmall">{JUMPBOX}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
			<td nowrap="nowrap" align="right">{JUMPBOX}</td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/viewtopic_poll_result.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full lines are longer
#
<img src="templates/subSilver/images/vote_lcap.gif"
<img src="{poll_option.POLL_OPTION_IMG}"
<img src="templates/subSilver/images/vote_rcap.gif"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
templates/subSilver/images/vote_lcap.gif
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{poll_option.POLL_OPTION_IMG_LEFT}
#
#----------[ IN-LINE FIND ]-----------------------------------
#
templates/subSilver/images/vote_rcap.gif
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{poll_option.POLL_OPTION_IMG_RIGHT}
#
#-----[ SAVE/CLOSE ALL FILES ]--------------------------------
#
# EoM